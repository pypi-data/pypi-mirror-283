resources:
  cloud: gcp
  cpus: 16+
  memory: 128+
  region: us-central1
  disk_size: 256
  accelerators: "L4:1"
  image_id: projects/hms-dev-greenberg-4923/global/images/bolero-240423

file_mounts:
  ~/.netrc: ~/.netrc  # for wandb

setup: |
  set -e  # Exit if any command failed.
  conda activate ray
  sudo mount 192.168.179.186:/filestore /mnt/filestore
  echo 'export SCPRINTER_DATA=/mnt/filestore/scprinter' >> ~/.bashrc
  ln -s -f /mnt/filestore /home/gcpuser/sky_workdir/

  if [ -f $HOME/.SKIPSETUP ]
  then
    echo "Skip setup"
  else
    pip install wandb --upgrade
    pip install scmallet bolero papermill
    pip install /mnt/filestore/pkg/scPrinter
    touch $HOME/.SKIPSETUP
  fi

run: |
  set -e  # Exit if any command failed.
  conda activate ray
  nohup jupyter-lab --LabApp.token='' --no-browser --port 3456 > ~/jupyter.log 2>&1 &
  papermill --cwd /mnt/filestore/240315-scPrinter/04.bulk_train/ -p split_id 0 /mnt/filestore/240315-scPrinter/04.bulk_train/02.train_bulk_model.ipynb /mnt/filestore/240315-scPrinter/04.bulk_train/02.train_bulk_model.split0.ipynb
