import{d as A,v as m,z as s,A as a,i as f,t as l,M as E,x as b,y as v,V as z,N as Y,O as j,P as L,Q as I,B as u,R as K,S as q,T as C,U as _,L as k,W as S,X as W,C as Q,D as H}from"./D3CI8m9t.js";import{D as J,V as M,O as Z,a as x,c as P,u as ee,b as U}from"./Cb9vhoRm.js";import{s as te,V as se,a as ae}from"./DRXGcTye.js";import{S as oe}from"./CXJizIje.js";import{V as ne,D as ie}from"./D6wGJThG.js";import{_ as O}from"./DlAUqK2U.js";import{V as le}from"./WVDAUELO.js";import{u as re}from"./BsX8Qw9W.js";import{D as ce}from"./BQlST21E.js";import{V as de}from"./Beenw6kv.js";import{V as F}from"./d5WQ-CLG.js";import{V as ue}from"./IYstpIev.js";import"./DyhB0PqA.js";import"./n17uZUSv.js";const me={info:1,important:2,secure:3,hardening:4,potentially:5,low:6,medium:7,high:8,critical:9},pe=A({name:"VulnzTable",components:{DfRisk:J},props:{vulnz:{type:Array,required:!0,default:()=>[]}},emits:["goToDetail","goToDetailNewTab","showVulnDetails"],data(){return{headers:[{title:"Show",value:"show",align:"left"},{title:"Risk | CVSS",value:"risk",align:"left"},{title:"Title",value:"title",align:"left"},{title:"Short description",value:"description",align:"left"}]}},computed:{kbVulnerabilities(){var o,p,h,D,g,d,n,c,w,$,T,r,B;const e=[];for(const t of this.vulnz)if(((o=t==null?void 0:t.kb)==null?void 0:o.title)==="Use of Outdated Vulnerable Component"){let V=!1;for(const i of t.vulnerabilities.vulnerabilities)if((i==null?void 0:i.metadata)===null||(i==null?void 0:i.metadata)===void 0)V||(e.push({key:i==null?void 0:i.id,goToVulnId:!1,risk:i==null?void 0:i.customRiskRating,title:t.kb.title,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb}),V=!0);else{const X=(p=i==null?void 0:i.metadata)==null?void 0:p.find(R=>R.name==="dependency_name").value,G=(h=i==null?void 0:i.metadata)==null?void 0:h.find(R=>R.name==="dependency_version").value;e.push({key:i.id,goToVulnId:!0,risk:i.customRiskRating,cvssV3:i.customCvssV3BaseScore,title:`${t.kb.title} for ${X} version ${G}`,securityIssue:t.kb.securityIssue,privacyIssue:t.kb.privacyIssue,targetedByMalware:t.kb.targetedByMalware,targetedByRansomware:t.kb.targetedByRansomware,targetedByNationState:t.kb.targetedByNationState,hasPublicExploit:t.kb.hasPublicExploit,description:t.kb.shortDescription,descriptionFormat:t.kb.shortDescriptionFormat,kb:t.kb})}}else e.push({key:(D=t==null?void 0:t.kb)==null?void 0:D.title,goToVulnId:!1,risk:t.highestRiskRating,title:(g=t==null?void 0:t.kb)==null?void 0:g.title,securityIssue:(d=t==null?void 0:t.kb)==null?void 0:d.securityIssue,privacyIssue:(n=t==null?void 0:t.kb)==null?void 0:n.privacyIssue,targetedByMalware:(c=t==null?void 0:t.kb)==null?void 0:c.targetedByMalware,targetedByRansomware:(w=t==null?void 0:t.kb)==null?void 0:w.targetedByRansomware,targetedByNationState:($=t==null?void 0:t.kb)==null?void 0:$.targetedByNationState,hasPublicExploit:(T=t==null?void 0:t.kb)==null?void 0:T.hasPublicExploit,cvssV3:t.highestCvssV3BaseScore,description:(r=t==null?void 0:t.kb)==null?void 0:r.shortDescription,descriptionFormat:(B=t==null?void 0:t.kb)==null?void 0:B.shortDescriptionFormat,kb:t.kb});return te(e).by([{desc:t=>{var V;return me[((V=t==null?void 0:t.risk)==null?void 0:V.toLocaleLowerCase())||""]}},{desc:t=>t.cvssV3}])}},methods:{goToDetail(e){this.$emit("goToDetail",e)},goToDetailNewTab(e){this.$emit("goToDetailNewTab",e)},showVulnDetails(e){this.$emit("showVulnDetails",e)}}}),he=["onClick","onMouseup"],ge=["onClick","onMouseup"];function fe(e,o,p,h,D,g){const d=f("DfRisk");return l(),m("div",null,[s(ne,{hover:"",headers:e.headers,items:e.kbVulnerabilities,"items-per-page":-1},{"item.risk":a(({item:n})=>[s(d,{"cvss-score":n.cvssV3,risk:n.risk,class:"cursor-pointer",onClick:c=>e.goToDetail(n),onMouseup:E(c=>e.goToDetailNewTab(n),["middle"])},null,8,["cvss-score","risk","onClick","onMouseup"])]),"item.title":a(({item:n})=>[b("div",{class:"cursor-pointer",onClick:c=>e.goToDetail(n),onMouseup:E(c=>e.goToDetailNewTab(n),["middle"])},v(n.title),41,he)]),"item.description":a(({item:n})=>[b("div",{class:"cursor-pointer",onClick:c=>e.goToDetail(n),onMouseup:E(c=>e.goToDetailNewTab(n),["middle"])},v(n.description),41,ge)]),"item.show":a(({item:n})=>[s(z,{size:"small",variant:"flat",icon:"mdi-magnify",onClick:c=>e.showVulnDetails(n)},null,8,["onClick"])]),_:2},1032,["headers","items"])])}const be=O(pe,[["render",fe]]),De=A({name:"VulnerabilityDetailDialog",components:{VulnerabilityDetail:se},props:{modelValue:{type:Boolean,default:!1},vuln:{type:Object,default:null},scanId:{type:Number,required:!0},scanner:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{loading:!1,dialog:!1}},computed:{vulnKey(){var e;return(e=this.vuln)==null?void 0:e.key}},watch:{modelValue:{immediate:!0,handler(e){this.dialog=e}},dialog(e){this.$emit("update:modelValue",e)}}}),ke={class:"vulnerability-detail-container"};function ye(e,o,p,h,D,g){const d=f("VulnerabilityDetail");return l(),m("div",ke,[s(le,{ref:"dialogRef",modelValue:e.dialog,"onUpdate:modelValue":o[0]||(o[0]=n=>e.dialog=n),scrollable:"",attach:"",eager:"","max-width":"50%",transition:"slide-x-transition",class:"ml-auto"},{default:a(()=>[s(M,{class:"dialog-card pa-2",loading:e.loading,style:{"min-height":"100vh"}},{default:a(()=>[s(d,{"vuln-title":e.vulnKey,"scan-id":e.scanId,scanner:e.scanner,"show-breadcrumbs":!1},null,8,["vuln-title","scan-id","scanner"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const Ve=O(De,[["render",ye]]),N=1,Se=A({name:"Index",components:{OXOAssets:Z,DfScanProgress:ce,DfConfirmationModal:ie,VulnzTable:be,VunerabilityDetailDialog:Ve,DfBreadcrumbs:x},data(){return{scanner:{endpoint:"",name:"",apiKey:""},vulnDetailsDialog:!1,selectedVulnerability:null,options:{page:1,itemsPerPage:15},vulnerabilityService:new ae(this.$axios),scanService:new oe(this.$axios),kb:null,title:"",progress:"UNKNOWN",vulns:[],loadingDialog:!0,stopBtnLoading:!1,deleteScanDialog:!1,archiveBtnLoading:!1,stopScanDialog:!1,assets:[],breadcrumbs:[{text:"scans",disabled:!1,to:"/scan/list",exact:!0},{text:"Scan",disabled:!1,to:`/scan/${this.$route.params.scan}`,exact:!0,scans:[]}]}},computed:{...Y(re,["scanners"]),scanId(){return this.$route.params.scan===void 0||this.$route.params.scan===null?(this.reportError("Scan ID not provided"),0):parseInt(this.$route.params.scan)},totalVulnerabilities(){var e;return((e=this.vulns)==null?void 0:e.length)||0}},async mounted(){const e=this.scanners.find(o=>P(o.endpoint)===this.$route.params.scanner);e===void 0?(this.reportError("Scanner not found"),this.$router.push({name:"scan-list"})):(this.scanner=e,await Promise.allSettled([this.fetchKBVulnerabilities(),this.fetchScans()]),this.updateBreadcrumbs())},methods:{...j(ee,["reportError","reportInfo","reportSuccess"]),async fetchKBVulnerabilities(){try{this.loadingDialog=!0;const e=await this.vulnerabilityService.getKBVulnerabilities(this.scanner,this.scanId);this.kb=e,this.vulns=(e==null?void 0:e.kbVulnerabilities)||[],this.title=e==null?void 0:e.title,this.assets=e==null?void 0:e.assets,this.progress=e==null?void 0:e.progress}catch(e){this.reportError(`An error was encountered while fetching the scan: ${e}`)}finally{this.loadingDialog=!1}},showVulnDetails(e){this.selectedVulnerability=e,this.vulnDetailsDialog=!0},goToDetail(e){this.$router.push({name:"scan-scanner-scan-vuln-vuln",params:{scan:this.scanId,scanner:P(this.scanner.endpoint),vuln:e.key??e.kb.id}})},goToDetailNewTab(e){const o=this.$router.resolve(`/scan/${P(this.scanner.endpoint)}/${this.scanId}/vuln/${e.key??e.kb.id}`);window.open(o.href,"_blank")},async fetchScans(){this.breadcrumbs[N].scans=await this.scanService.getScans(this.scanner,{page:1,numberElements:20})},updateBreadcrumbs(){var o,p,h;((p=((o=this.breadcrumbs[N])==null?void 0:o.scans)||[])==null?void 0:p.find(D=>{var g;return D.id===((g=this.kb)==null?void 0:g.id)}))===void 0&&(this.breadcrumbs[N].scans=[...((h=this.breadcrumbs[N])==null?void 0:h.scans)||[],this.kb])},async stopScan(){try{this.stopBtnLoading=!0,await this.scanService.stopScan(this.scanner,this.scanId),await this.fetchKBVulnerabilities()}catch(e){this.reportError((e==null?void 0:e.message)||"Error Stopping scan.")}finally{this.stopBtnLoading=!1}},async deleteScan(){try{this.loadingDialog=!0,await this.scanService.deleteScan(this.scanner,this.scanId),this.reportSuccess("Scan deleted successfully"),this.$router.push("/scan/list")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e.message}`)}finally{this.loadingDialog=!1}}}}),y=e=>(Q("data-v-1239117f"),e=e(),H(),e),ve=y(()=>b("span",null,"Stops scan. Stopped scans can't be restarted.",-1)),we=y(()=>b("span",null,"Archives scan and removes all findings and artifacts.",-1)),$e=y(()=>b("p",{class:"mb-0 mr-2"}," Title: ",-1)),Te={key:0,class:"mb-0"},Be={key:1},Ie={key:1},Ce=y(()=>b("p",{class:"mb-0 mr-2"}," Targets: ",-1)),_e=y(()=>b("p",{class:"mb-0 mr-2"}," Progress: ",-1)),Ne=y(()=>b("p",{class:"mb-0 mr-2"}," Date: ",-1)),Me={key:0,class:"mb-0"},Re={key:1},Ee={key:1};function Pe(e,o,p,h,D,g){const d=f("DfConfirmationModal"),n=f("VunerabilityDetailDialog"),c=f("DfBreadcrumbs"),w=f("OXOAssets"),$=f("DfScanProgress"),T=f("VulnzTable");return l(),m("div",null,[s(d,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":o[0]||(o[0]=r=>e.deleteScanDialog=r),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.deleteScan},null,8,["modelValue","onConfirm"]),s(d,{modelValue:e.stopScanDialog,"onUpdate:modelValue":o[1]||(o[1]=r=>e.stopScanDialog=r),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.stopScan},null,8,["modelValue","onConfirm"]),s(n,{"model-value":e.vulnDetailsDialog,"onUpdate:modelValue":o[2]||(o[2]=r=>e.vulnDetailsDialog=r),vuln:e.selectedVulnerability,"scan-id":e.scanId,scanner:e.scanner},null,8,["model-value","vuln","scan-id","scanner"]),s(c,{"scan-id":e.scanId,breadcrumbs:e.breadcrumbs,scanner:e.scanner,class:"mb-5"},null,8,["scan-id","breadcrumbs","scanner"]),s(M,{class:"d-flex pl-3 py-3 mt-3",variant:"outlined"},{default:a(()=>[s(F,{bottom:""},{activator:a(({props:r})=>[s(z,L({disabled:e.progress==="STOPPED"||e.progress==="DONE",loading:e.stopBtnLoading,class:"mr-2"},r,{onClick:o[3]||(o[3]=B=>e.stopScanDialog=!0)}),{default:a(()=>[s(I,{start:""},{default:a(()=>[u(" mdi-stop-circle-outline ")]),_:1}),u(" Stop ")]),_:2},1040,["disabled","loading"])]),default:a(()=>[ve]),_:1}),s(F,{bottom:""},{activator:a(({props:r})=>[s(z,L({loading:e.archiveBtnLoading,class:"mr-2"},r,{onClick:o[4]||(o[4]=B=>e.deleteScanDialog=!0)}),{default:a(()=>[s(I,{start:""},{default:a(()=>[u(" mdi-delete-outline ")]),_:1}),u(" Delete ")]),_:2},1040,["loading"])]),default:a(()=>[we]),_:1})]),_:1}),s(de,{class:"mt-4 align-stretch"},{default:a(()=>[s(ue,{cols:"12",lg:"12"},{default:a(()=>[s(M,{loading:e.loadingDialog,height:"100%",variant:"outlined"},{default:a(()=>[s(U,null,{default:a(()=>[s(I,{start:""},{default:a(()=>[u(" mdi-shield-check-outline ")]),_:1}),u(" Scan Details ")]),_:1}),s(K),s(q,null,{default:a(()=>[s(C,null,{default:a(()=>[s(_,{class:"d-flex align-center"},{default:a(()=>[$e,e.title!==null&&e.title!==""?(l(),m("p",Te,v(e.title),1)):(l(),m("div",Be,[e.loadingDialog===!0?(l(),k(S,{key:0,variant:"tonal",size:"small",label:"",style:{width:"80px"}})):(l(),m("span",Ie,"-"))]))]),_:1})]),_:1}),s(C,null,{default:a(()=>[s(_,{class:"d-flex align-center"},{default:a(()=>[Ce,e.loadingDialog===!0?(l(),k(S,{key:0,variant:"tonal",label:"",style:{width:"90px"}})):(l(),k(w,{key:1,assets:e.assets},null,8,["assets"]))]),_:1})]),_:1}),s(C,null,{default:a(()=>[s(_,{class:"d-flex align-center"},{default:a(()=>[_e,e.loadingDialog===!0?(l(),k(S,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(l(),k($,{key:1,progress:e.progress},null,8,["progress"]))]),_:1})]),_:1}),s(C,null,{default:a(()=>[s(_,{class:"d-flex align-center"},{default:a(()=>[Ne,e.loadingDialog===!1&&e.kb!==null?(l(),m("p",Me,v(e.$moment(e.kb.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)):(l(),m("div",Re,[e.loadingDialog===!0?(l(),k(S,{key:0,variant:"tonal",size:"x-small",label:"",style:{width:"180px"}})):(l(),m("span",Ee,"-"))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),s(M,{loading:e.loadingDialog,class:"mt-12",justify:"space-around",variant:"outlined"},{default:a(()=>[s(U,null,{default:a(()=>[s(I,{start:""},{default:a(()=>[u(" mdi-bug-outline ")]),_:1}),u(" Vulnerabilities "),e.totalVulnerabilities!==null?(l(),k(S,{key:0,size:"small",class:"ml-2"},{default:a(()=>[u(v(e.totalVulnerabilities),1)]),_:1})):W("",!0)]),_:1}),s(K),s(T,{vulnz:e.vulns,onGoToDetail:e.goToDetail,onGoToDetailNewTab:e.goToDetailNewTab,onShowVulnDetails:e.showVulnDetails},null,8,["vulnz","onGoToDetail","onGoToDetailNewTab","onShowVulnDetails"])]),_:1},8,["loading"])])}const He=O(Se,[["render",Pe],["__scopeId","data-v-1239117f"]]);export{He as default};
