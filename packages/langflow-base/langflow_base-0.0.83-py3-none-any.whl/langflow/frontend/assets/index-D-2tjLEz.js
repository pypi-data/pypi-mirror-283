import{a$ as D,b0 as G,b1 as V,b2 as se,b3 as ae,b4 as te,b5 as re,b6 as H,b7 as M,p as ne,aC as le,r as h,j as e,I as oe,$ as v,aN as C,b8 as E,aQ as I,aP as _,aO as k,a as b,d as S,b9 as K,g as R,f as w,ba as U,aj as ie,bb as ce,aw as de,bc as T,bd as ue,be as he,bf as me,bg as fe,h as pe,au as xe,bh as ge,A,u as O,af as p}from"./index-RTIdJwvY.js";import{I as N}from"./index-BrZPUhkQ.js";import"./input-DMknjEnf.js";import"./popover-DgVJMzX_.js";const Pe=t=>{const{mutate:l}=D();return l(["usePostAddApiKey"],async s=>(await G.post(`${V("API_KEY")}/store`,{api_key:s.key})).data,t)},Y=()=>{const{query:t}=D();return t(["useGetProfilePicturesQuery"],async()=>(await G.get(`${V("FILES")}/profile_pictures/list`)).data,{placeholderData:se})},je=(t,l,r)=>({handlePatchPassword:async(s,o,i)=>{var c,n;if(s!==o){r({title:ae,list:[te]});return}try{s!==""&&await re(t.id,{password:s}),i({target:{name:"password",value:""}}),i({target:{name:"cnfPassword",value:""}}),l({title:H})}catch(u){r({title:M,list:[(n=(c=u==null?void 0:u.response)==null?void 0:c.data)==null?void 0:n.detail]})}}}),ye=(t,l,r,d)=>({currentUserData:r,handlePatchProfilePicture:async o=>{var i,c;try{if(o!==""){await ne(r.id,{profile_image:o});let n=le(r);n.profile_image=o,d(n)}t({title:H})}catch(n){l({title:M,list:[(c=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:c.detail]})}}}),we=(t,l)=>{h.useEffect(()=>{const r=document.getElementById(t??"null");r&&r.scrollIntoView({behavior:"smooth"})},[t]),h.useEffect(()=>{l("")},[l])},Ae=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(oe,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),be=({password:t,cnfPassword:l,handleInput:r,handlePatchPassword:d})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:s=>{d(t,l,r),s.preventDefault()},children:e.jsxs(C,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(E,{children:[e.jsx(I,{children:"Password"}),e.jsx(_,{children:"Type your new password and confirm it."})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(b,{name:"password",className:"w-full",children:[e.jsx(N,{id:"pasword",onChange:s=>{r({target:{name:"password",value:s}})},value:t,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(S,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(b,{name:"cnfPassword",className:"w-full",children:[e.jsx(N,{id:"cnfPassword",onChange:s=>{r({target:{name:"cnfPassword",value:s}})},value:l,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(S,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(K,{className:"border-t px-6 py-4",children:e.jsx(R,{asChild:!0,children:e.jsx(w,{type:"submit",children:"Save"})})})]})})}),Se=(t,l)=>{const r=async d=>Promise.all(d.map(s=>new Promise(o=>{const i=new Image;i.src=s,i.onload=o,i.onerror=o})));h.useEffect(()=>{const d=[];Object.keys(t).flatMap(s=>t[s].map(o=>d.push(`${U}files/profile_pictures/${s}/${o}`))),r(d).then(()=>{l(!0)})},[t])};function Ne({profilePictures:t,loading:l,value:r,onChange:d}){const s=h.useRef(null),o=ie(n=>n.dark),[i,c]=h.useState(!1);return h.useEffect(()=>{var n;r&&s&&((n=s.current)==null||n.scrollIntoView({behavior:"smooth",block:"center"}))},[s,r]),Se(t,c),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:l||!i?e.jsx(ce,{}):Object.keys(t).map((n,u)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:n})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:t[n].map((m,f)=>e.jsx(w,{ref:r===n+"/"+m?s:void 0,unstyled:!0,onClick:()=>d(n+"/"+m),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${U}files/profile_pictures/${n+"/"+m}`,style:{filter:r===n+"/"+m?o?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:de("h-12 w-12")},f)}))})})]}))})}const ve=({profilePicture:t,handleInput:l,handlePatchProfilePicture:r,handleGetProfilePictures:d,userData:s})=>{const[o,i]=h.useState({}),{data:c,isFetching:n}=Y();return h.useEffect(()=>{var u;c!=null&&c.files&&((u=c==null?void 0:c.files)==null||u.forEach(m=>{const[f,g]=m.split("/");i(x=>(x[f]?x[f].push(g):x[f]=[g],x))}))},[c]),e.jsx(v,{onSubmit:u=>{r(t),u.preventDefault()},children:e.jsxs(C,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(E,{children:[e.jsx(I,{children:"Profile Picture"}),e.jsx(_,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(k,{children:e.jsx("div",{className:"py-2",children:e.jsx(Ne,{profilePictures:o,loading:n,value:t==""?(s==null?void 0:s.profile_image)??T[parseInt((s==null?void 0:s.id)??"",30)%T.length]:t,onChange:u=>{l({target:{name:"profilePicture",value:u}})}})})}),e.jsx(K,{className:"border-t px-6 py-4",children:e.jsx(R,{asChild:!0,children:e.jsx(w,{type:"submit",children:"Save"})})})]})})},Ce=({apikey:t,handleInput:l,handleSaveKey:r,loadingApiKey:d,validApiKey:s,hasApiKey:o})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:i=>{i.preventDefault(),r(t,l)},children:e.jsxs(C,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(E,{children:[e.jsx(I,{children:"Store API Key"}),e.jsx(_,{children:(o&&!s?ue:o?"":he)+me})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(b,{name:"apikey",className:"w-full",children:[e.jsx(N,{id:"apikey",onChange:i=>{l({target:{name:"apikey",value:i}})},value:t,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(S,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[fe," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(K,{className:"border-t px-6 py-4",children:e.jsx(R,{asChild:!0,children:e.jsx(w,{loading:d,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Ke=()=>{const t=pe(a=>a.setCurrentFlowId),{scrollId:l}=xe(),[r,d]=h.useState(ge),{autoLogin:s}=h.useContext(A),o=O(a=>a.setSuccessData),i=O(a=>a.setErrorData),{userData:c,setUserData:n}=h.useContext(A),u=p(a=>a.hasStore),m=p(a=>a.validApiKey),f=p(a=>a.hasApiKey),g=p(a=>a.loadingApiKey),{password:x,cnfPassword:q,profilePicture:B,apikey:Q}=r,{storeApiKey:W}=h.useContext(A),$=p(a=>a.updateHasApiKey),F=p(a=>a.updateValidApiKey),L=p(a=>a.updateLoadingApiKey),{handlePatchPassword:z}=je(c,o,i),J=()=>{const{data:a}=Y();return a},{handlePatchProfilePicture:X}=ye(o,i,c,n);we(l,t);const{mutate:Z}=Pe({onSuccess:()=>{o({title:"API key saved successfully"}),$(!0),F(!0),L(!1),P({target:{name:"apikey",value:""}})},onError:a=>{var j,y;i({title:"API key save error",list:[(y=(j=a==null?void 0:a.response)==null?void 0:j.data)==null?void 0:y.detail]}),$(!1),F(!1),L(!1)}}),ee=a=>{a&&(Z({key:a}),W(a))};function P({target:{name:a,value:j}}){d(y=>({...y,[a]:j}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(ve,{profilePicture:B,handleInput:P,handlePatchProfilePicture:X,handleGetProfilePictures:J,userData:c}),!s&&e.jsx(be,{password:x,cnfPassword:q,handleInput:P,handlePatchPassword:z}),u&&e.jsx(Ce,{apikey:Q,handleInput:P,handleSaveKey:ee,loadingApiKey:g,validApiKey:m,hasApiKey:f})]})]})};export{Ke as GeneralPage,Ke as default};
