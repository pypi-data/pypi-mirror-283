"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6285],{26285:function(e,t,r){r.d(t,{Z:function(){return $}});var n=r(90849),i=r(90089),a=r(89348),s=r(28841),o=r(27378),c=r(40397),u=r(73679),l=r(55732),d=r(97865),p=r(34707),f=r.n(p),m=r(78624),y=r(24753),b=r(51860),v=r(33167),h=r(34090),x=r(88486),j=r(82547),g=r(14633),O=r(43139),k=r(4938),D=r(24246),w=["customFieldValues"],P=["onSubmit","initialValues","onDelete"];function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C=g.Ry().shape({data_categories:g.IX(g.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:g.Z_().required().label("Data use"),data_subjects:g.IX(g.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),Z={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:"",cookies:[]},V=function(e){e.customFieldValues;var t,r=(0,i.Z)(e,w);return _(_({},r),{},{name:null!==(t=e.name)&&void 0!==t?t:"",cookies:r.cookies.map((function(e){return{name:e,path:"/"}}))})},E=function(e){var t=e.allDataUses,r=e.allDataCategories,n=e.allDataSubjects,i=e.allDatasets,a=e.privacyDeclarationId,o=e.includeCookies,c=e.includeCustomFields,u=i?i.map((function(e){var t;return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}})):[];return(0,D.jsxs)(s.Kqy,{spacing:4,children:[(0,D.jsx)(O.AP,{id:"data_use",label:"Data use",name:"data_use",options:t.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",variant:"stacked",singleValueBlock:!0,isDisabled:!!a}),(0,D.jsx)(O.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!a}),(0,D.jsx)(O.AP,{name:"data_categories",label:"Data categories",options:r.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",isMulti:!0,variant:"stacked",isDisabled:!0}),(0,D.jsx)(O.AP,{name:"data_subjects",label:"Data subjects",options:n.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",isMulti:!0,variant:"stacked",isDisabled:!0}),o?(0,D.jsx)(O.VT,{name:"cookies",label:"Cookies",options:[],isMulti:!0,variant:"stacked",isClearable:!1}):null,i?(0,D.jsx)(O.AP,{name:"dataset_references",label:"Dataset references",options:u,tooltip:"Referenced Dataset fides keys used by the system.",isMulti:!0,variant:"stacked"}):null,c?(0,D.jsx)(j.uc,{resourceType:k.P6.PRIVACY_DECLARATION,resourceFidesKey:a}):null]})},I=function(e){var t=e.onSubmit,r=e.initialValues,n=e.allDataUses,i=e.privacyDeclarationId,a=(0,j.mZ)({resourceType:k.P6.PRIVACY_DECLARATION,resourceFidesKey:i}),c=a.customFieldValues,u=a.upsertCustomFields,d=(0,o.useMemo)((function(){return function(e,t){var r,n;return e?_(_({},e),{},{customFieldValues:t||{},cookies:null!==(r=null===(n=e.cookies)||void 0===n?void 0:n.map((function(e){return e.name})))&&void 0!==r?r:[]}):Z}(r,c)}),[r,c]),p=(0,o.useState)(!1),m=p[0],y=p[1],b=(0,o.useMemo)((function(){var e=n.filter((function(e){return e.fides_key===d.data_use}))[0];if(e)return d.name?"".concat(e.name," - ").concat(d.name):e.name}),[n,d]),v=function(){var e=(0,l.Z)(f().mark((function e(r,n){var i,a,s,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.customFieldValues,a=V(r),e.next=4,t(a,n);case 4:if(!(s=e.sent)){e.next=12;break}if(!((o=s.filter((function(e){return e.data_use===r.data_use&&(!e.name||e.name===r.name)}))).length>0)){e.next=10;break}return e.next=10,u({customFieldValues:i,fides_key:o[0].id});case 10:n.resetForm({values:r}),y(!0);case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return{handleSubmit:v,renderHeader:function(e){var t=e.dirty,r=e.boxProps,n=e.hideSaved;return(0,D.jsxs)(s.xuv,_(_({display:"flex",alignItems:"center",justifyContent:"space-between"},r),{},{children:[b?(0,D.jsx)(s.X6q,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:b}):null,!n&&m&&!t&&d.data_use?(0,D.jsxs)(s.xvT,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,D.jsx)(s.StI,{})," Saved"]}):null]}))},initialValues:d}},F=function(e){var t=e.onSubmit,r=e.initialValues,n=e.onDelete,a=(0,i.Z)(e,P),o=I({onSubmit:t,initialValues:r,allDataUses:a.allDataUses,privacyDeclarationId:null===r||void 0===r?void 0:r.id}),c=o.handleSubmit,u=o.renderHeader,l=o.initialValues;return(0,D.jsx)(h.J9,{enableReinitialize:!0,initialValues:l,onSubmit:c,validationSchema:C,children:function(e){var t=e.dirty;return(0,D.jsxs)(h.l0,{children:[(0,D.jsx)(x.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,D.jsxs)(s.Kqy,{spacing:4,children:[(0,D.jsx)(s.xuv,{"data-testid":"header",children:u({dirty:t})}),(0,D.jsx)(E,_({onDelete:n},a))]})]})}})},T=["privacyDeclaration","onEdit","onDelete","includeCustomFields","includeCookies"],A=["privacyDeclarations"];function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M=function(e){var t=e.privacyDeclaration,r=e.onEdit,n=e.onDelete,a=e.includeCustomFields,o=e.includeCookies,c=(0,i.Z)(e,T),u=I(W({initialValues:t,onSubmit:function(e){return r(t,e)},privacyDeclarationId:t.id},c)),l=u.initialValues,d=u.renderHeader,p=u.handleSubmit;return(0,D.jsx)(s.Qdk,{children:function(e){var r=e.isExpanded;return(0,D.jsx)(h.J9,{enableReinitialize:!0,initialValues:l,onSubmit:p,validationSchema:C,children:function(e){var i=e.dirty;return(0,D.jsxs)(h.l0,{"data-testid":"".concat(t.data_use,"-form"),children:[(0,D.jsx)(x.Gt,{id:"".concat(t.id,"-form"),name:t.id}),(0,D.jsxs)(s.KFZ,{py:4,borderBottomWidth:r?"0px":"1px",backgroundColor:r?"gray.50":void 0,"data-testid":"accordion-header-".concat(t.data_use),children:[d({dirty:i,boxProps:{flex:"1",textAlign:"left"},hideSaved:!r}),(0,D.jsx)(s.XEm,{})]}),(0,D.jsx)(s.Hk3,{backgroundColor:"gray.50",pt:0,children:(0,D.jsx)(s.Kqy,{spacing:4,children:(0,D.jsx)(E,W({privacyDeclarationId:t.id,onDelete:n,includeCustomFields:a,includeCookies:o},c))})})]})}})}})},R=function(e){var t=e.privacyDeclarations,r=(0,i.Z)(e,A);return(0,D.jsx)(s.UQy,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:t.map((function(e){return(0,D.jsx)(M,W({privacyDeclaration:e},r),e.id)}))})},q=["system","addButtonProps","includeCustomFields","includeCookies","onSave"];function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var K=function(e){var t=e.system,r=(e.addButtonProps,e.includeCustomFields),n=e.includeCookies,a=e.onSave,c=(0,i.Z)(e,q),p=(0,s.pmc)(),h=(0,b.qQ)(),x=(0,d.Z)(h,1)[0],j=(0,o.useState)(!1),g=j[0],O=j[1],k=(0,o.useState)(void 0),w=k[0],P=k[1],S=(0,o.useMemo)((function(){return w?t.privacy_declarations.filter((function(e){return e.id!==w.id})):t.privacy_declarations}),[w,t]),_=function(e){return S.filter((function(t){return t.data_use===e.data_use&&t.name===e.name})).length>0&&(p((0,y.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0)},C=function(){var e=(0,l.Z)(f().mark((function e(r,n){var i,s,o,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.map((function(e){var t;return H(H({},e),{},{name:null!==(t=e.name)&&void 0!==t?t:""})})),s=H(H({},t),{},{privacy_declarations:i}),o=function(e){if(!(0,v.isErrorResult)(e))return p.closeAll(),p((0,y.t5)(n?"Data use deleted":"Data use saved")),a&&a(e.data),e.data.privacy_declarations;var t=(0,m.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");p((0,y.Vo)(t))},e.next=5,x(s);case 5:return c=e.sent,e.abrupt("return",o(c));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Z=function(){var e=(0,l.Z)(f().mark((function e(r,n){var i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.id===r.id||!_(n)){e.next=2;break}return e.abrupt("return",void 0);case 2:return i=t.privacy_declarations.map((function(e){return e.id===r.id?n:e})),e.abrupt("return",C(i));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),V=function(){var e=(0,l.Z)(f().mark((function e(t){var r,n,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_(t)){e.next=2;break}return e.abrupt("return",void 0);case 2:return p.closeAll(),r=[].concat((0,u.Z)(S),[t]),e.next=6,C(r);case 6:return(n=e.sent)&&(i=n.filter((function(e){return(!e.name||e.name===t.name)&&e.data_use===t.data_use}))[0],P(i)),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,l.Z)(f().mark((function e(r){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.privacy_declarations.filter((function(e){return e.id!==r.id})),e.abrupt("return",C(n,!0));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=(0,l.Z)(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t);case 2:return(r=e.sent)&&(O(!1),P(void 0)),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){O(!1)}),[t.fides_key]),(0,D.jsxs)(s.Kqy,{spacing:3,children:[(0,D.jsx)(R,H({privacyDeclarations:S,onEdit:Z,onDelete:E,includeCustomFields:r,includeCookies:n},c)),g?(0,D.jsx)(s.xuv,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,D.jsx)(F,H({initialValues:w,onSubmit:V,onDelete:I,includeCustomFields:r,includeCookies:n},c))}):null,0===t.privacy_declarations.length?(0,D.jsx)(s.xvT,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},U=r(60041);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X={name:"",description:""},G=function(e){var t,r=e.system,n="/systems/configure/".concat(r.fides_key),i=function(e){var t=(0,b.dB)(),r=(0,d.Z)(t,1)[0],n=(0,s.pmc)(),i=function(){var t=(0,l.Z)(f().mark((function t(i,a){var s,o;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=[N(N({},e),{},{name:i.name,description:i.description})],t.next=3,r(s);case 3:o=t.sent,(0,U.D4)(o)?n((0,y.Vo)((0,m.e$)(o.error))):(n((0,y.t5)("Successfully saved system info")),a.resetForm({values:i}));case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}();return{handleUpsertSystem:i,validationSchema:g.Ry().shape({name:g.Z_().required().label("Name"),description:g.Z_().required().label("Description")})}}(r),a=i.handleUpsertSystem,o=i.validationSchema;return(0,D.jsxs)(s.xuv,{children:[(0,D.jsxs)(s.kCb,{alignItems:"center",children:[(0,D.jsx)(s.xvT,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,D.jsx)(s.LZC,{}),(0,D.jsxs)(s._pl,{color:"complimentary.500",href:n,children:["View more",(0,D.jsx)(s.h0n,{ml:2})]})]}),(0,D.jsx)(s.xuv,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,D.jsx)(h.J9,{enableReinitialize:!0,initialValues:null!==(t=r)&&void 0!==t?t:X,validationSchema:o,onSubmit:a,children:function(e){var t=e.isSubmitting,r=e.dirty,n=e.isValid;return(0,D.jsxs)(h.l0,{children:[(0,D.jsx)(x.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,D.jsx)(s.xuv,{marginTop:3,children:(0,D.jsx)(O.j0,{label:"System name",name:"name",variant:"stacked"})}),(0,D.jsx)(s.xuv,{marginTop:3,children:(0,D.jsx)(O.Ks,{label:"System Description",name:"description",variant:"stacked"})}),(0,D.jsx)(s.kCb,{marginTop:6,justifyContent:"flex-end",children:(0,D.jsx)(s.zxk,{textAlign:"right",type:"submit",disabled:!r||!n,colorScheme:"primary",isLoading:t,size:"sm",children:"Save"})})]})}})})]})},Y=["isLoading"];function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $=function(e){var t,r=e.selectedSystemId,n=e.resetSelectedSystemId,u=(0,o.useMemo)((function(){return Boolean(r)}),[r]),l=(0,c.f)({includeDatasets:!1,includeDisabled:!1}),d=(l.isLoading,(0,i.Z)(l,Y)),p=(0,b.rn)(r,{skip:!r}).data;return(0,D.jsx)(s.xuv,{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,overflow:"hidden",children:(0,D.jsx)(s.Mi4,{transition:{enter:{ease:"easeInOut",duration:.5},exit:{ease:"easeInOut",duration:.5}},direction:"right",in:u,unmountOnExit:!0,style:{zIndex:11,pointerEvents:"none",position:"absolute"},children:(0,D.jsxs)(s.xuv,{position:"absolute",right:"0px",height:"100%",width:"100%",maxWidth:"480px",pointerEvents:"auto",borderWidth:0,boxShadow:"0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)",display:r?"unset":"none",backgroundColor:"white","data-testid":"datamap-drawer",children:[(0,D.jsx)(s.xuv,{id:"drawer-header",borderBottomWidth:1,paddingX:6,paddingY:3,children:(0,D.jsxs)(s.kCb,{children:[(0,D.jsx)(s.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:(0,D.jsx)(s.xvT,{fontWeight:"semibold",fontSize:"lg",lineHeight:"7",color:"gray.900",children:null!==(t=null===p||void 0===p?void 0:p.name)&&void 0!==t?t:"System Information"})}),(0,D.jsx)(s.LZC,{}),(0,D.jsx)(s.kCb,{alignItems:"center",children:(0,D.jsx)(s.hU,{icon:(0,D.jsx)(s.Two,{}),"aria-label":"Close error message",size:"sm",style:{height:"24px",width:"24px",minWidth:"14px",backgroundColor:"#00000000"},onClick:n,"data-testid":"datamap-drawer-close"})})]})}),(0,D.jsx)(s.xuv,{id:"drawer-body",height:"calc(100% - 46px)",overflowY:"auto",padding:6,style:{scrollbarGutter:"stable"},children:p?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(G,{system:p}),(0,D.jsx)(s.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,D.jsx)(s.xuv,{borderTop:"1px solid",borderColor:"gray.200",children:(0,D.jsx)(s.xuv,{pb:3,children:(0,D.jsx)(K,Q({system:p,addButtonProps:{ml:4}},d))})}),(0,D.jsx)(s.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,D.jsx)(a.q,{system:p})]}):null})]})})})}}}]);