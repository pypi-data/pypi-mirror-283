"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[8010],{98515:(e,t,o)=>{o.d(t,{Kl:()=>D});var n=o(63612),l=o(31529),r=o(93345),a=o(74292),i=o(690),s=o(98772),u=o(38562),c=o(81388),d=o(91206),h=o(63065),p=o(63259),m=o(12166);const g=({subplotsMetaData:e,horizontalLimit:t,verticalLimit:o,style:l})=>{const{formatMessage:r}=(0,m.useIntl)(),a=e.horizontal.keys.length,i=e.vertical.keys.length,s=a>t,u=s&&i>o?r({id:"aui.dataVisualization.subplots.tooManyHorizontalAndVerticalSubplots"},{horizontalSubplotLimit:t,verticalSubplotLimit:o,horizontalSubplotTotal:a,verticalSubplotTotal:i,horizontalLevelName:e.horizontal.levelName,verticalLevelName:e.vertical.levelName}):r({id:"aui.dataVisualization.subplots.tooManySubplots"},{limit:s?t:o,total:s?a:i,areTooManyHorizontalSubplots:s,subplotLevelName:s?e.horizontal.levelName:e.vertical.levelName});return(0,n.Y)(p.Alert,{message:`${u} ${r({id:"aui.dataVisualization.subplots.editQuery"})}`,showIcon:!0,banner:!0,style:{...l,zIndex:1},type:"warning"})};var f=o(16361),y=o(61202),b=o(1019);const v={left:"unset",right:0,transform:"translateY(-50%) translateX(100%) rotate(90deg)"},C={right:"unset",left:0,transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"};var I=o(61979);class x extends Error{}const S=({selectedPointsByTrace:e,traces:t,data:o})=>{const n=(0,f.getHierarchyIndicesInCellSet)(o),l=[];return e.forEach(((e,r)=>{t[r]&&l.push(...(({selectedPoints:e,cellsIndices:t,data:o,hierarchyIndicesInCellSet:n})=>{const l=[];return e.forEach((e=>{(t[e]||[]).forEach((r=>{if(!r)throw new x(`The point at index ${e} is marked as selected but it exceeds the number of points on the chart: ${t.length}`);{const{columnIndex:e,rowIndex:t,cellIndex:a}=r,i=(0,f.getTuple)({columnIndex:e,rowIndex:t,data:o,hierarchyIndicesInCellSet:n});if(i){const e=o.cells[a];l.push({tuple:i,value:e.value})}}}))})),l})({selectedPoints:e,cellsIndices:t[r].cellsIndices,data:o,hierarchyIndicesInCellSet:n}))})),{cells:l}},w=36,z=(0,r.lazy)((()=>Promise.all([o.e(8814),o.e(8318)]).then(o.bind(o,38318)))),M=e=>(0,n.Y)(r.Suspense,{fallback:(0,n.Y)("div",{children:"Loading..."}),children:(0,n.Y)(z,{...e})});function k(e){return(0,l.range)(e).map((()=>[]))}function T(e){const{pointIndex:t,pointNumber:o}=e;return void 0!==t?t:o}function D(e){const t=(0,r.useMemo)((()=>e.onSelectionChange||(()=>{})),[e.onSelectionChange]),o=(0,r.useRef)(null),[p,z]=(0,r.useState)(null),D=(0,h.useIsContextMenuOpen)(),L=e.widgetState?.plotly?.layout,Y=e.widgetState?.plotly?.config,E=e.widgetState?.plotly?.data,N=(0,r.useMemo)((()=>function(e,t={}){const{additionalTraces:o,commonTraceOverride:n,overridesByTraceIndex:r,overridesByTraceKey:a}=t;return[...e.map(((e,t)=>(0,l.defaultsDeep)({},a?.[e._key],r?.[t],n,e))),...o||[]]}(e.traces,E)),[e.traces,E]),P=function(e){const{backgroundColor:t,textColor:o,black:n}=e;return(0,r.useMemo)((()=>function({backgroundColor:e,textColor:t,black:o}){return{bgColor:e,fontColor:t,hoverBgColor:o,hoverFontColor:e,zeroLineColor:(0,i.j)(t,.5),lineColor:(0,i.j)(t,.25),gridColor:(0,i.j)(t,.25)}}({backgroundColor:t,textColor:o,black:n})),[t,o,n])}((0,s.DP)()),B=(0,r.useMemo)((()=>({displaylogo:!1,modeBarButtonsToRemove:["resetScale2d","toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian","toggleHover"],...Y})),[Y]),[_,R]=(0,r.useState)([]),[V,$]=(0,r.useState)({}),[F,j]=(0,r.useState)([]),H=(0,r.useRef)(null);(0,r.useEffect)((()=>{try{const o=S({selectedPointsByTrace:_,traces:N,data:e.data});t(o)}catch(e){e instanceof x&&R([])}}),[_,N,e.data,t]);const K=e.metaData.subplots.horizontal.limit,O=e.metaData.subplots.vertical.limit,X=e.metaData.subplots.horizontal.keys.length>K||e.metaData.subplots.vertical.keys.length>O,A=(0,r.useMemo)((()=>X?{height:e.size.height-w,width:e.size.width}:e.size),[X,e.size]),Q=(0,r.useMemo)((()=>function({chartThemeValues:e,layoutOverrides:t,layout:o,hiddenLabels:n,size:r}){return(0,l.defaultsDeep)((0,l.cloneDeep)(t),o,{colorway:I.Y,plot_bgcolor:e.bgColor,paper_bgcolor:e.bgColor,font:{color:e.fontColor},hoverlabel:{bgcolor:e.hoverBgColor,bordercolor:e.hoverBgColor,font:{color:e.hoverFontColor}},hovermode:"closest",margin:{t:30,r:0,b:40},xaxis:{automargin:!0,zerolinecolor:e.zeroLineColor,linecolor:e.lineColor,gridcolor:e.gridColor,range:[]},yaxis:{automargin:!0,zerolinecolor:e.zeroLineColor,linecolor:e.lineColor,gridcolor:e.gridColor,range:[]},hiddenlabels:n,...r})}({chartThemeValues:P,layoutOverrides:L,layout:e.layout,hiddenLabels:F,size:A})),[P,L,e.layout,F,A]),[U,q,W]=(0,d.useMousePosition)(),G=(0,r.useMemo)((()=>N.map(((e,t)=>({...(0,l.omit)(e,"cellsIndices"),selectedpoints:_[t],...V[e._key]})))),[N,_,V]),J=function({cube:e,data:t,hierarchyIndicesInCellSet:o,hoveredPoint:n,traces:l,style:a}){const{formatMessage:i}=(0,m.useIntl)(),s=i({id:"aui.total"});return(0,r.useMemo)((()=>{if(null===n)return[];const r=l[n.traceIndex].cellsIndices[n.pointIndex];if(!r)return[];const i=[];return r.forEach((e=>{const{columnIndex:n,rowIndex:l,cellIndex:r}=e,s=(0,f.getTuple)({columnIndex:n,data:t,hierarchyIndicesInCellSet:o,rowIndex:l});if(s){const e=t.cells[r],o=s.find((({dimensionName:e,hierarchyName:t})=>"Measures"===e&&"Measures"===t)),n=o?a?.measures?.[o.namePath[0]]:void 0;i.push({tuple:s,formattedValue:(0,y.m)({valueFormattedByActivePivot:e.formattedValue,measureStyle:n,value:Number(e.value)})})}})),(0,b.F)({cube:e,tuplesAndFormattedValues:i,captionForTotals:s})}),[e,t,l,o,n,a,s])}({cube:e.cube,data:e.data,hierarchyIndicesInCellSet:e.metaData.hierarchyIndicesInCellSet,hoveredPoint:p,traces:e.traces,style:e.widgetState.style}),{placement:Z,style:ee,arrowStyle:te}=function({hoveredPoint:e,container:t,tooltipContent:o}){const[n,l,a]=(0,r.useMemo)((()=>{if(null===e||null===t)return[null,null,null];const o=t.getBoundingClientRect();return[e.offsetY,e.offsetX+18,o.width-e.offsetX+18]}),[e,t]);return(0,r.useMemo)((()=>{if(null===n||null===l||null===a||null===t)return{placement:"left",style:{opacity:0},arrowStyle:v};const e=22*o.length+12;return l>a?{placement:"left",style:{top:n-e/2+"px !important",right:`${a}px !important`,left:"unset !important",paddingLeft:"unset"},arrowStyle:v}:{placement:"right",style:{top:n-e/2+"px !important",right:"unset !important",left:`${l}px !important`,paddingRight:"unset"},arrowStyle:C}}),[n,l,a,t,o])}({hoveredPoint:p,container:H.current,tooltipContent:J}),oe=X?(0,n.Y)(g,{style:{height:w},subplotsMetaData:e.metaData.subplots,horizontalLimit:K,verticalLimit:O}):null;return(0,n.Y)(r.Fragment,{children:(0,n.FD)("div",{className:"atoti-ui-plot","data-number-of-cells":e.data.cells.length,css:{height:"100%",position:"relative",width:"100%",":focus":{outline:"none"},".ant-tooltip":{maxWidth:"unset",...ee},".ant-tooltip-arrow":te},tabIndex:0,onMouseDown:()=>{H.current&&H.current.focus()},onKeyUp:e=>{"Escape"===e.key&&R([])},ref:H,children:[oe,(0,n.Y)(d.Tooltip,{open:!D&&J.length>0,title:(0,n.Y)(a.U,{content:J}),placement:Z,getPopupContainer:()=>H.current||document.body,overlayStyle:{maxWidth:350},children:(0,n.Y)("div",{css:{position:"absolute",top:X?w:0,bottom:0,left:0,right:0,".js-plotly-plot":{height:"100%"},".plot-container-plotly":{height:"100%"},"@media print":{".modebar-container":{display:"none"}}},onContextMenu:e=>{e.preventDefault()},children:(0,n.Y)(M,{config:B,data:G,layout:Q,onInitialized:function(t,o){e.onInitialized&&e.onInitialized(t,o),e.onLoaded&&(0,c.R)(e.onLoaded)},onClick:function(e){if(e&&e.event){const{event:t}=e,o=e.points[0];switch(t.button){case 0:!function(e,t){const{curveNumber:o}=t,n=T(t),r=e[u.P?"metaKey":"ctrlKey"];let a=r&&_.length>0?(0,l.cloneDeep)(_):k(N.length);const i=a[o].indexOf(n);r?-1===i?a[o].push(n):a[o].splice(i,1):_.length>0&&_.every(((e,t)=>t===o?1===e.length&&e[0]===n:0===e.length))?a=[]:a[o]=[n],R(a)}(t,o);break;case 2:!function(e,t){const{curveNumber:o}=t,n=T(t);if(!(_[o]||[]).includes(n)){const e=k(N.length);e[o]=[n],R(e)}e.wasHandled=!0}(t,o)}}},onSelected:function(e){if(e){const t=e.points.reduce(((e,{curveNumber:t,pointIndex:o})=>(e[t].push(o),e)),k(N.length));R(t)}},onHover:e=>{q(),o.current=setTimeout((()=>{if(W(),e&&H.current){const t=H.current.getBoundingClientRect(),o=e.points[0],{curveNumber:n}=o,l=T(o);z({traceIndex:n,pointIndex:l,offsetX:U.current?.x-t.left,offsetY:U.current?.y-t.top})}}),300)},onUnhover:function(){W(),z(null),o.current&&(clearTimeout(o.current),o.current=null)},onUpdate:function(e){e.data.some((e=>e.visible!==V[e._key]?.visible))&&$(e.data.reduce(((e,t)=>({...e,[t._key]:{visible:t.visible}})),{})),e.layout.hiddenlabels&&!(0,l.isEqual)(e.layout.hiddenlabels,F)&&j(e.layout.hiddenlabels)}})})})]})})}},79853:(e,t,o)=>{o.d(t,{w:()=>r});var n=o(59644),l=o(24205);const r=e=>{if(0===e.horizontal.captions.length&&0===e.vertical.captions.length)return{};const t=(0,l.y)(e.vertical),o=(0,l.y)(e.horizontal),r=[];for(let e=0;e<t;e++){const t=[];for(let l=0;l<o;l++){const o=0===l?"x":`x${l+1}`,r=(0,n.D)(e);t.push(`${o}${r}`)}r.push(t)}return{grid:{rows:t,columns:o,subplots:r,pattern:"coupled"}}}},59644:(e,t,o)=>{function n(e){return 0===e?"y":"y"+(2*e+1)}o.d(t,{D:()=>n})},24205:(e,t,o)=>{o.d(t,{y:()=>n});const n=({captions:e,limit:t})=>Math.max(1,Math.min(e.length,t))},65484:(e,t,o)=>{o.d(t,{c:()=>h});var n=o(63612),l=o(77593),r=o(93345),a=o(16361),i=o(64751),s=o(91206),u=o(63065),c=o(31069),d=o(76054);function h(e){return t=>{const{cube:o}=(0,u.useCube)(t.widgetState),{widgetState:h,queryResult:p,onLoaded:m}=t,g=t.queryResult.data,f=(0,r.useMemo)((()=>Boolean(g&&0===g.cells.length)),[g]),y=(0,r.useMemo)((()=>(0,u.isMappingEmpty)(h?.mapping)),[h?.mapping]),b=(0,r.useRef)(null),v=(0,s.useDebouncedComponentSize)(b),[C]=(0,i.useWidgetPlugins)([h.widgetKey]),{attributes:I}=C,x=(0,r.useMemo)((()=>{const e=I?(0,u.getSafeMapping)(h.mapping,I):h.mapping;return{...h,mapping:e}}),[h,I]),S=(0,d.r)(x,p,o);if(p.error){if((0,a.isQueryErrorOfType)(p.error,"QueryTimeoutException"))throw new a.QueryTimeoutError(p.error);throw new a.MdxError(p.error)}return function({isEmpty:e,onLoaded:t}){(0,r.useEffect)((()=>{e&&void 0!==t&&t()}),[])}({isEmpty:y||f,onLoaded:m}),(0,n.Y)("div",{ref:b,css:l.css`
          height: 100%;
        `,children:o&&g&&S&&!y&&!f?(0,n.Y)(e,{...t,widgetState:x,cube:o,data:g,metaData:S,size:v}):(0,n.Y)(c.u,{reason:f?"noData":void 0})})}}}}]);