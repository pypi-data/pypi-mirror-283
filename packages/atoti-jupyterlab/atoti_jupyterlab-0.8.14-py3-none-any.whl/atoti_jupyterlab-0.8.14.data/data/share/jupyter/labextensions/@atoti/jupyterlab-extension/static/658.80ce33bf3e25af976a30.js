"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[658],{98277:(e,t,r)=>{r.r(t),r.d(t,{canOpenDrillthroughOnSelection:()=>g,getDrillthroughWidgetFilters:()=>y,pluginMenuItemOpenDrillthrough:()=>x});var n=r(63612),i=r(93345),a=r(12166),l=r(52476),s=r(16361),o=r(83666),u=r(90519),m=r(32767),h=r(66138),d=r(57637),c=r(63065);function g(e){return void 0!==e&&!(e.axes&&e.axes.length>0)&&void 0!==e.cells&&1===e.cells.length&&void 0!==e.cells[0].value}var p=r(46689),f=r(72262);function b(e,t){const{dimensionName:r,hierarchyName:n}=e;return t.some((e=>(0,f.q)(e,{dimensionName:r,hierarchyName:n})))}function y({sourceWidgetFilters:e,tuple:t}){return[...(e||[]).filter((e=>!b(e,t))),...t.map((({dimensionName:e,hierarchyName:t,namePath:r})=>({type:"members",dimensionName:e,hierarchyName:t,members:[r]})))]}const x={key:"open-drillthrough",useMenuItem:e=>{const{selection:t,widgetState:r}=e,{cube:f}=(0,c.useCube)(r),{formatMessage:x}=(0,a.useIntl)(),C=(0,o.g)(),D=(0,i.useMemo)((()=>{if(g(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,s.isTotal)((0,h.q)(e,f),e)))}),[f,t]),v=(0,i.useMemo)((()=>{if(D){const e=D.filter((e=>"Measures"!==e.dimensionName));return x({id:"aui.plugins.menu-item.open-drillthrough.openDrillthrough"},{member:e.length>0?(0,s.getTupleCaption)(e,{captionForTotals:x({id:"aui.total"}),cube:f,separator:", ",hasOnlyCaptionForLeafLevels:!0}):void 0})}}),[x,D,f]),N=(0,i.useCallback)((async()=>{if(C&&v&&D&&(0,l.M)(e)){const t=(0,u.z)(e.dashboardState.pagesOrder),n=e.dashboardState.pagesOrder.indexOf(C),i=e.dashboardState.pages[C];if(void 0===r.query.mdx)return;const a=function({name:e,sourceWidget:t,sourceWidgetPage:r,tuple:n,cube:i}){const a=y({sourceWidgetFilters:t.filters,tuple:n}),l={mdx:(0,c.getDefaultMdxDrillthrough)(i.name)};t.query.mdx&&t.query.mdx.withClause&&(l.mdx.select.withClause=t.query.mdx.withClause);const s=(r.filters||[]).filter((e=>!b(e,n)));return{name:e,content:{0:{...p._.initialState,shouldUseDefaultColumns:!0,query:l,serverKey:t.serverKey,initialCubeName:i.name,filters:a}},layout:{direction:"column",children:[{leafKey:"0",size:1}]},filters:s}}({name:v,sourceWidget:r,sourceWidgetPage:i,tuple:D,cube:f}),l=(0,m.H)(e.dashboardState,{page:a,key:t,index:n+1});e.onDashboardChange(l),e.onActivePageChange(t)}}),[C,f,v,e,D,r]);if((0,l.M)(e)&&D&&r.query.mdx)return{icon:(0,n.Y)(d.IconDrillthrough,{}),label:v,onClick:N}},translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"},"fr-FR":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {sur {member}}\n          }"}}}}}]);