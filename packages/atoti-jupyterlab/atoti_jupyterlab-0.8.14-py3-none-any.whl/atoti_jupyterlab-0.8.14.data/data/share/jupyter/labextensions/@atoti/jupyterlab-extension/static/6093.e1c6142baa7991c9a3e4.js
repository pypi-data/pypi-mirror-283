"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[6093],{36093:(e,t,s)=>{s.r(t),s.d(t,{DataModelLoadingError:()=>w,MdxError:()=>R,QueryTimeoutError:()=>D,addMissingTotalRows:()=>Z,axisIds:()=>V,createActivePivotClient:()=>I,forEachCell:()=>O,getAxisId:()=>Q,getAxisLength:()=>$,getCellSetMetaData:()=>W,getHierarchyIndicesInCellSet:()=>F,getMembersByHierarchy:()=>H,getMissingTotals:()=>Y,getQueryTotalsMetaData:()=>ce,getSortedTupleKey:()=>K,getTuple:()=>A,getTupleCaption:()=>G,getTupleKey:()=>B,getVisibleCubeDrillthroughColumns:()=>N,isCellSet:()=>y,isQueryErrorOfType:()=>_,isTotal:()=>U,trimTrailingTotals:()=>z});var r=s(40311),i=s(80391),n=s(58720);class a extends i.d{_unsafeWebSocket;pingPeriod;pingIntervalId;webSocketUrl;constructor({url:e,serverVersion:t,serviceVersion:s,requestInit:r,pingPeriod:i}){super({url:e,serverVersion:t,serviceVersion:s,requestInit:r}),this.pingPeriod=i||6e4,this.webSocketUrl=((e,t)=>{const[s,r]=e.split("://"),{wsPath:i}=t;return"https"===s?`wss://${r}${i}`:`ws://${r}${i}`})(e,s)}get webSocket(){if(!this._unsafeWebSocket)throw new Error("The WebSocket connection has not been established yet.");return this._unsafeWebSocket}async ping(e){await(0,n.h)(this.url,this.serviceVersion,{...this.requestInit,...e})}async openWebSocket(){this._unsafeWebSocket||(await this.ping({credentials:"include"}),this.pingIntervalId=window.setInterval((()=>{this.ping({credentials:"include"})}),this.pingPeriod),this._unsafeWebSocket=new WebSocket(this.webSocketUrl))}closeWebSocket(){this._unsafeWebSocket&&(this._unsafeWebSocket.readyState!==WebSocket.CLOSED&&this._unsafeWebSocket.close(),this._unsafeWebSocket=void 0),this.pingIntervalId&&clearInterval(this.pingIntervalId)}}var o=s(3486),c=s(77105),u=s(60402),l=s(53704),d=s(29991),h=s(7518),b=s(19166),m=s(25906),p=s(90147),g=s(31529);function y(e){return"cells"in e}function f(e){return"success"===e.status}class v extends Error{queryId;constructor(e){super(`No query exists for id: "${e}".`),this.queryId=e}}const S={connectionStatus:"disconnected",connectionStatusSubscribers:[],dataModelSubscribers:[],isDataModelLoading:!1,calculatedMembers:{},calculatedMembersSubscribers:{},drillthroughColumns:{},drillthroughColumnsSubscribers:{},nextQueryId:0,_map:{}};class w extends Error{serverUrl;constructor(e,t){super(`Could not load the data model from ${e}`,t),this.serverUrl=e}}var M=s(62355);async function C({url:e,pivotServiceVersion:t,requestInit:s,mdxDefinitionStatement:r,owners:i,readers:n}){await(0,M.K)(`${e}${t.restPath}/cube/configuration/execute`,{...s,method:"POST",headers:{"Content-Type":"application/json",...s?.headers},body:JSON.stringify({statement:r,owners:i,readers:n})})}var q=s(96979);async function T({cubeName:e,serverUrl:t,pivotServiceVersion:s,options:r}){const{restPath:i}=s;return(await(0,M.K)(`${t}${i}/cube/configuration/calculatedMembers/${e}`,r)).json()}async function x({serverUrl:e,pivotServiceVersion:t,options:s}){const{restPath:r}=t;return(await(0,M.K)(`${e}${r}/cube/discovery`,s)).json()}async function L({url:e,pivotServiceVersion:t,cubeName:s,requestInit:r}){const{restPath:i}=t;return(await(0,M.K)(`${e}${i}/cube/query/mdx/drillthroughheaders`,{...r,method:"POST",headers:{"Content-Type":"application/json",...r?.headers},body:`{"mdx": "DRILLTHROUGH SELECT FROM [${s}]"}`})).json()}function k(e,t){const s=e.name.identifiers[0];return s.value===t?e:(0,p.produce)(e,(e=>{e.name.identifiers.unshift({elementType:"Identifier",quoting:s.quoting,value:t})}))}class E extends a{state=S;listenerToUnsubscribe={calculatedMembers:{},connectionStatus:new WeakMap,dataModel:new WeakMap,drillthroughColumns:{},query:{},queryResult:{}};constructor({url:e,serverVersion:t,serviceVersion:s,requestInit:i,pingPeriod:n}){super({url:e,serverVersion:t,serviceVersion:s,requestInit:{...i,headers:{...i?.headers,"x-activeui-version":r.activeuiVersion}},pingPeriod:n})}static create({url:e,serviceVersion:t,serverVersion:s,requestInit:r,pingPeriod:i}){const n=new E({url:e,serverVersion:s,serviceVersion:t,requestInit:r,pingPeriod:i});return n.connect(),n}async connect(){if("connected"===this.connectionStatus)return;const e=new Promise((e=>{const t=this.subscribeToConnectionStatus((()=>{e(),t()}))}));if("disconnected"===this.connectionStatus){this.dispatch({type:"webSocketOpening"});try{await this.openWebSocket(),this.webSocket.addEventListener("open",(()=>{this.dispatch({type:"webSocketOpened"})})),this.webSocket.addEventListener("message",(e=>{const t=JSON.parse(e.data);this.dispatch({type:"webSocketMessageReceived",message:t})})),this.webSocket.addEventListener("close",(()=>{this.disconnect()})),this.webSocket.addEventListener("error",(()=>{this.dispatch({type:"webSocketErrored"})}))}catch(e){if(this.disconnect(),e instanceof o.h)return;throw e}}return e}disconnect(){"disconnected"!==this.connectionStatus&&(this.closeWebSocket(),this.dispatch({type:"webSocketClosed"}))}dispatch(e){const[t,s]=function(e,t){const{state:s,sideEffects:r}=(0,p.produce)({state:e,sideEffects:[]},(({state:s,sideEffects:r})=>{switch(t.type){case"queryRegistered":{const{id:e,mdx:i,context:n,ranges:a,updateMode:o="once"}=t;if(void 0!==s._map[e]?.query)throw new Error(`Cannot register a query for id: "${e}", because a query is already registered with this id.`);const c=s.nextQueryId.toString();s.nextQueryId+=1;const u=s._map[e]?.querySubscribers??[],l=s._map[e]?.queryResultSubscribers??[],d={mdx:i,context:n,ranges:a,updateMode:o};return s._map[e]={queryVersion:c,queryResult:{isLoading:!0},query:d,querySubscribers:u,queryResultSubscribers:l},void r.push({type:"webSocketSendMessage",message:{action:"REGISTER",data:{initialState:"once"===o?"PAUSED":"STARTED",streamId:e,queryId:c,mdxQuery:{mdx:i,context:n},ranges:a}}})}case"queryUpdated":{const{id:i,mdx:n,context:a,ranges:o,updateMode:c}=t,u=e._map[i]?.query,l=s._map[i]?.query;if(!u||!l)throw new v(i);const d=n&&(u.mdx!==n||!(0,g.isEqual)(u.context,a)),h=o&&!(0,g.isEqual)(u.ranges,o),b=c&&u.updateMode!==c;if(!d&&!h&&!b)return;const m=e._map[i].queryForCurrentResult?.mdx===n&&(0,g.isEqual)(e._map[i].queryForCurrentResult?.context,a)&&(0,g.isEqual)(e._map[i].queryForCurrentResult?.ranges,o);if(d||h)if(m)s._map[i].queryResult.isLoading=!1,s._map[i].query=e._map[i].queryForCurrentResult,s._map[i].queryVersion=e._map[i].queryVersionForCurrentResult;else{const e=s.nextQueryId.toString();s.nextQueryId+=1,s._map[i].queryVersion=e,s._map[i].queryResult={...s._map[i].queryResult,isLoading:!0},n&&d?(l.mdx=n,l.context=a,o&&h&&(l.ranges=o),r.push({type:"webSocketSendMessage",message:{action:"UPDATE",data:{streamId:i,queryId:e,mdxQuery:{mdx:n,context:a},ranges:o}}})):o&&h&&(l.ranges=o,r.push({type:"webSocketSendMessage",message:{action:"RANGE_UPDATE",data:{streamId:i,queryId:e,ranges:o}}}))}if(c&&b){s._map[i].query.updateMode=c;const e="once"===c;r.push({type:"webSocketSendMessage",message:{action:e?"PAUSE":"RESUME",data:i}})}return}case"queryRefreshed":{const e=t.id,i=s._map[e]?.query;if(!i)throw new v(e);return s._map[e].queryResult.isLoading=!0,void r.push({type:"webSocketSendMessage",message:{action:"REFRESH",data:e}})}case"queryUnregistered":if(void 0!==s._map[t.id]){const e=s._map[t.id].query,i=s._map[t.id].querySubscribers,n=s._map[t.id].queryResultSubscribers;i&&i.length>0||n&&n.length>0?s._map[t.id]={querySubscribers:i,queryResultSubscribers:n}:Reflect.deleteProperty(s._map,t.id),void 0!==e&&r.push({type:"webSocketSendMessage",message:{action:"UNREGISTER",data:t.id}})}return;case"webSocketOpening":return void(s.connectionStatus="connecting");case"webSocketOpened":s.connectionStatus="connected";for(const e in s._map){const t=s._map[e].query;if(t){const i=s._map[e].queryVersion;if(void 0===i)throw new Error(`Query with id ${e} is defined in the client state, but has no associated query version.`);const{mdx:n,context:a,updateMode:o,ranges:c}=t,u={action:"REGISTER",data:{initialState:"once"===o?"PAUSED":"STARTED",streamId:e,queryId:i,mdxQuery:{mdx:n,context:a},ranges:c}};r.push({type:"webSocketSendMessage",message:u})}}return;case"webSocketClosed":case"webSocketErrored":return void(s.connectionStatus="disconnected");case"subscribedToConnectionStatus":return void s.connectionStatusSubscribers.push(t.callback);case"unsubscribedFromConnectionStatus":return void(0,g.pull)(s.connectionStatusSubscribers,t.callback);case"subscribedToQuery":return void 0===s._map[t.id]&&(s._map[t.id]={querySubscribers:[]}),void 0===s._map[t.id]?.querySubscribers&&(s._map[t.id].querySubscribers=[]),void s._map[t.id].querySubscribers.push(t.callback);case"subscribedToQueryResult":return void 0===s._map[t.id]&&(s._map[t.id]={queryResultSubscribers:[]}),void 0===s._map[t.id]?.queryResultSubscribers&&(s._map[t.id].queryResultSubscribers=[]),void s._map[t.id].queryResultSubscribers.push(t.callback);case"unsubscribedFromQuery":return void(0,g.pull)(s._map[t.id].querySubscribers,t.callback);case"unsubscribedFromQueryResult":return void(0,g.pull)(s._map[t.id].queryResultSubscribers,t.callback);case"webSocketMessageReceived":{const{message:r}=t;if(void 0===e._map[r.streamId]||r.queryId!==e._map[r.streamId].queryVersion)return;s._map[r.streamId].queryForCurrentResult=e._map[r.streamId].query,s._map[r.streamId].queryVersionForCurrentResult=e._map[r.streamId].queryVersion;const i={isLoading:!1};return f(r)?(i.data=function(e,t){if(f(t))switch(t.type){case"cellData":if(void 0===e)throw new Error("Should have existing data to update.");if(!y(e))throw new Error("Received a Cellset update from ActivePivot about a query whose last result was a DrillthroughResult. This is not supported.");return(0,p.produce)(e,(e=>{e.epoch=t.data.epoch;const s=new Map;e.cells.forEach((({ordinal:e},t)=>{s.set(e,t)}));let r=!1;t.data.cells.forEach((t=>{const i=s.get(t.ordinal);void 0===i?(e.cells.push(t),r=!0):e.cells[i]=t})),r&&(e.cells=(0,g.sortBy)(e.cells,"ordinal"))}));case"drillthroughUpdateData":if(void 0===e)throw new Error("Received a Drillthrough update from ActivePivot about a query without a prior full drillthrough result. This is not supported.");if(y(e))throw new Error("Received a Drillthrough update from ActivePivot about a query whose last result was a Cellset. This is not supported.");return(0,p.produce)(e,(e=>{e.epoch=t.data.epoch;const{addedOrUpdatedRows:s,removedRows:r}=t.data;if(s&&Object.keys(s).forEach((t=>{const r=parseInt(t,10);e.result.rows[r]=s[r]})),r){r.sort();for(let t=r.length-1;t>=0;t--)e.result.rows.splice(r[t],1)}}));case"cellSetData":return{...t.data,cells:(0,g.sortBy)(t.data.cells,"ordinal")};case"drillthroughData":return t.data;default:throw new Error(`Unexpected ActivePivot client message type: "${t.type}". Valid types are ["cellData", "drillthroughUpdateData", "cellSetData", "drillthroughData"]`)}}(e._map[r.streamId].queryResult.data,r),i.error=void 0):i.error=r.error,void(s._map[r.streamId].queryResult=i)}case"dataModelLoadingStarted":s.isDataModelLoading=!0;break;case"dataModelLoadingErrored":s.isDataModelLoading=!1,s.dataModelLoadingError=t.error,s.dataModel=void 0;break;case"dataModelLoaded":s.isDataModelLoading=!1,s.dataModel=t.dataModel,s.dataModelLoadingError=void 0;break;case"subscribedToDataModel":s.dataModelSubscribers.push(t.callback);break;case"unsubscribedFromDataModel":(0,g.pull)(s.dataModelSubscribers,t.callback);break;case"drillthroughColumnsLoading":(0,g.set)(s,["drillthroughColumns",t.cubeName,"isLoading"],!0);break;case"drillthroughColumnsLoaded":s.drillthroughColumns[t.cubeName]={isLoading:!1,drillthroughColumns:t.drillthroughColumns,error:t.error};break;case"subscribedToDrillthroughColumns":t.cubeName in s.drillthroughColumnsSubscribers||(s.drillthroughColumnsSubscribers[t.cubeName]=[]),s.drillthroughColumnsSubscribers[t.cubeName].push(t.callback);break;case"unsubscribedFromDrillthroughColumns":(0,g.pull)(s.drillthroughColumnsSubscribers[t.cubeName],t.callback);break;case"calculatedMembersLoading":(0,g.set)(s,["calculatedMembers",t.cubeName,"isLoading"],!0);break;case"calculatedMembersLoaded":s.calculatedMembers[t.cubeName]={isLoading:!1,calculatedMembers:t.calculatedMembers,error:t.error};break;case"subscribedToCalculatedMembers":t.cubeName in s.calculatedMembersSubscribers||(s.calculatedMembersSubscribers[t.cubeName]=[]),s.calculatedMembersSubscribers[t.cubeName].push(t.callback);break;case"unsubscribedFromCalculatedMembers":(0,g.pull)(s.calculatedMembersSubscribers[t.cubeName],t.callback);break;default:throw new Error(`Unexpected ActivePivot client reducer event type: "${t.type}". Valid types are ["queryRegistered", "queryUpdated", "queryRefreshed", "queryUnregistered", "webSocketOpening", "webSocketOpened", "webSocketClosed", "webSocketErrored", "subscribedToQuery", "unsubscribedFromQuery", "subscribedToQueryResult", "unsubscribedFromQueryResult", "subscribedToConnectionStatus", "unsubscribedFromConnectionStatus", "webSocketMessageReceived", "dataModelLoadingStarted", "dataModelLoaded", "subscribedToDataModel", "unsubscribedFromDataModel", "drillthroughColumnsLoaded", "subscribedToDrillthroughColumns", "unsubscribedFromDrillthroughColumns", "calculatedMembersLoaded", "subscribedToCalculatedMembers", "unsubscribedFromCalculatedMembers"]`)}}));return[s,r]}(this.state,e);s.forEach((e=>{if("webSocketSendMessage"!==e.type)throw new Error(`Unexpected ActivePivot client sideEffect type: ${e.type}. Valid types are ["webSocketSendMessage"]`);"connected"===t.connectionStatus&&this.webSocket.send(JSON.stringify(e.message))}));const r=this.state._map,i=this.connectionStatus,n=this.isDataModelLoading,a=this.dataModel,o=this.dataModelLoadingError,c=this.state.calculatedMembers,u=this.state.drillthroughColumns;this.state=t;for(const e in t._map){const{query:t,queryResult:s,querySubscribers:i,queryResultSubscribers:n}=this.state._map[e]||{},{query:a,queryResult:o}=r[e]||{};t!==a&&i?.forEach((e=>{e()})),s!==o&&n?.forEach((e=>{e()}))}this.connectionStatus!==i&&t.connectionStatusSubscribers.forEach((e=>{e()})),this.isDataModelLoading===n&&this.dataModel===a&&this.dataModelLoadingError===o||t.dataModelSubscribers.forEach((e=>{e()}));for(const e in this.state.drillthroughColumns){const t=this.state.drillthroughColumns[e],s=u[e],{drillthroughColumns:r,isLoading:i}=t;r===s?.drillthroughColumns&&i===s?.isLoading||this.state.drillthroughColumnsSubscribers[e]?.forEach((e=>{e()}))}for(const e in this.state.calculatedMembers){const t=this.state.calculatedMembers[e],s=c[e],{calculatedMembers:r,isLoading:i}=t;r===s?.calculatedMembers&&i===s?.isLoading||this.state.calculatedMembersSubscribers[e]?.forEach((e=>{e()}))}}register(e,t){this.dispatch({type:"queryRegistered",id:e,...t})}update(e,t){this.dispatch({type:"queryUpdated",id:e,...t})}setQuery(e,t){void 0!==this.state._map[e]?.query?this.update(e,t):this.register(e,t)}get connectionStatus(){return this.state.connectionStatus}subscribeToConnectionStatus(e){return this.dispatch({type:"subscribedToConnectionStatus",callback:e}),()=>{this.dispatch({type:"unsubscribedFromConnectionStatus",callback:e})}}addConnectionStatusListener(e){(0,b.l)("addConnectionStatusListener","Use subscribeToConnectionStatus instead");const t=this.subscribeToConnectionStatus((()=>{e(this.connectionStatus)}));this.listenerToUnsubscribe.connectionStatus.set(e,t)}removeConnectionStatusListener(e){(0,b.l)("addConnectionStatusListener","Use subscribeToConnectionStatus instead");const t=this.listenerToUnsubscribe.connectionStatus.get(e);if(!t)throw new Error("addConnectionStatusListener must be called before calling this method.");t()}getQuery(e){return this.state._map[e]?.query}subscribeToQuery(e,t){return this.dispatch({type:"subscribedToQuery",id:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromQuery",id:e,callback:t})}}addQueryListener(e,t){(0,b.l)("addQueryListener","Use subscribeToQuery instead");const s=this.subscribeToQuery(e,(()=>{t(this.getQuery(e))}));this.listenerToUnsubscribe.query[e]||(this.listenerToUnsubscribe.query[e]=new WeakMap),this.listenerToUnsubscribe.query[e].set(t,s)}removeQueryListener(e,t){const s=this.listenerToUnsubscribe.query[e]?.get(t);if(!s)throw new Error("addQueryListener must be called before calling this method.");s()}getQueryResult(e){return this.state._map[e]?.queryResult}subscribeToQueryResult(e,t){return this.dispatch({type:"subscribedToQueryResult",id:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromQueryResult",id:e,callback:t}),0===this.state._map[e].queryResultSubscribers?.length&&this.dispatch({type:"queryUnregistered",id:e})}}addQueryResultListener(e,t){(0,b.l)("addQueryResultListener","Use subscribeToQueryResult instead");const s=this.subscribeToQueryResult(e,(()=>{t(this.getQueryResult(e))}));this.listenerToUnsubscribe.queryResult[e]||(this.listenerToUnsubscribe.queryResult[e]=new WeakMap),this.listenerToUnsubscribe.queryResult[e].set(t,s)}removeQueryResultListener(e,t){(0,b.l)("removeQueryResultListener","Use subscribeToQueryResult instead");const s=this.listenerToUnsubscribe.queryResult[e]?.get(t);if(!s)throw new Error("addQueryResultListener must be called before calling this method.");s()}refreshQuery(e){this.dispatch({type:"queryRefreshed",id:e})}async loadDataModel({signal:e}={}){this.dispatch({type:"dataModelLoadingStarted"});try{const t=await async function(e){switch((0,q.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await x(e)).data}(e);default:return x(e)}}({serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:e}}),s=(0,c.v)(t);this.__UNSAFE_setDataModel__(s)}catch(e){this.__UNSAFE_setDataModel__(void 0,new w(this.url,{cause:e}))}}get dataModel(){return this.state.dataModel}get isDataModelLoading(){return this.state.isDataModelLoading}get dataModelLoadingError(){return this.state.dataModelLoadingError}get drillthroughColumns(){return this.state.drillthroughColumns}get calculatedMembers(){return this.state.calculatedMembers}__UNSAFE_setDataModel__(e,t){e?this.dispatch({type:"dataModelLoaded",dataModel:e}):t&&this.dispatch({type:"dataModelLoadingErrored",error:t})}subscribeToDataModel(e){return this.dispatch({type:"subscribedToDataModel",callback:e}),()=>{this.dispatch({type:"unsubscribedFromDataModel",callback:e})}}addDataModelListener(e){(0,b.l)("addDataModelListener","Use subscribeToDataModel instead");const t=this.subscribeToDataModel((()=>{e(this.dataModel)}));this.listenerToUnsubscribe.dataModel.set(e,t)}removeDataModelListener(e){(0,b.l)("removeDataModelListener","Use subscribeToDataModel instead");const t=this.listenerToUnsubscribe.dataModel.get(e);if(!t)throw new Error("addDataModelListener must be called before calling this method.");t()}async loadDrillthroughColumns(e,{signal:t}={}){const s=this.state.drillthroughColumns[e];if(s&&s.isLoading)return;let r,i;this.dispatch({type:"drillthroughColumnsLoading",cubeName:e});try{i=await async function(e){switch((0,q.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await L(e)).data}(e);default:return L(e)}}({url:this.url,pivotServiceVersion:this.serviceVersion,cubeName:e,requestInit:{...this.requestInit,signal:t}})}catch(e){r=(0,m.$)(e),console.error(r)}this.dispatch({type:"drillthroughColumnsLoaded",cubeName:e,drillthroughColumns:i,error:r})}subscribeToDrillthroughColumns(e,t){return this.dispatch({type:"subscribedToDrillthroughColumns",cubeName:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromDrillthroughColumns",cubeName:e,callback:t})}}addDrillthroughColumnsListener(e,t){(0,b.l)("addDrillthroughColumnsListener","Use subscribeToDrillthroughColumns instead");const s=this.subscribeToDrillthroughColumns(e,(()=>{const{drillthroughColumns:s,isLoading:r,error:i}=this.drillthroughColumns[e];t(s,{error:i,isLoading:r})}));this.listenerToUnsubscribe.drillthroughColumns[e]||(this.listenerToUnsubscribe.drillthroughColumns[e]=new WeakMap),this.listenerToUnsubscribe.drillthroughColumns[e].set(t,s)}removeDrillthroughColumnsListener(e,t){(0,b.l)("removeDrillthroughColumnsListener","Use subscribeToDrillthroughColumns instead");const s=this.listenerToUnsubscribe.drillthroughColumns[e]?.get(t);if(!s)throw new Error("addDrillthroughColumnsListener must be called before calling this method.");s()}async loadCalculatedMembers(e,{signal:t}={}){const s=this.state.calculatedMembers[e];if(s&&s.isLoading)return;let r,i;this.dispatch({type:"calculatedMembersLoading",cubeName:e});try{i=await async function(e){switch((0,q.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await T(e)).data}(e);default:return T(e)}}({cubeName:e,serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:t}})}catch(e){r=(0,m.$)(e),console.error(r)}this.dispatch({type:"calculatedMembersLoaded",cubeName:e,calculatedMembers:i,error:r})}subscribeToCalculatedMembers(e,t){return this.dispatch({type:"subscribedToCalculatedMembers",cubeName:e,callback:t}),()=>{this.dispatch({type:"unsubscribedFromCalculatedMembers",cubeName:e,callback:t})}}addCalculatedMembersListener(e,t){(0,b.l)("addCalculatedMembersListener","Use subscribeToCalculatedMembers instead");const s=this.subscribeToCalculatedMembers(e,(()=>{const{calculatedMembers:s,isLoading:r,error:i}=this.calculatedMembers[e];t(s,{error:i,isLoading:r})}));this.listenerToUnsubscribe.calculatedMembers[e]||(this.listenerToUnsubscribe.calculatedMembers[e]=new WeakMap),this.listenerToUnsubscribe.calculatedMembers[e].set(t,s)}removeCalculatedMembersListener(e,t){(0,b.l)("removeCalculatedMembersListener","Use subscribeToCalculatedMembers instead");const s=this.listenerToUnsubscribe.calculatedMembers[e]?.get(t);if(!s)throw new Error("addCalculatedMembersListener must be called before calling this method.");s()}async createCalculatedMember({formula:e,cubeName:t,owners:s,readers:r}){const i=k(e,t),n=`CREATE ${(0,l.A)(i)}`;await C({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:s,readers:r}),await this.loadCalculatedMembers(t)}async deleteCalculatedMember({memberUniqueName:e,cubeName:t}){const s=(0,d._)(e),r=`DROP MEMBER ${s[0]===t?e:(0,h.hD)(t,...s)}`;await C({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:r}),await this.loadCalculatedMembers(t)}async updateCalculatedMember({formula:e,cubeName:t,owners:s,readers:r}){const i=k(e,t),n=`UPDATE ${(0,l.A)(i)}`;await C({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:s,readers:r}),await this.loadCalculatedMembers(t)}async createKpi({kpi:e,cubeName:t,owners:s,readers:r}){let i=`CREATE KPI ${(0,h.hD)(t,e.name)} AS ${e.value}`;u.S.map((e=>e.slice(3))).forEach((t=>{const s=t;e[s]&&(i=`${i}, ${s.toUpperCase()}=${e[s]}`)})),await C({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:i,owners:s,readers:r})}async deleteKpi({kpiName:e,cubeName:t}){const s=`DROP KPI ${(0,h.hD)(t,e)}`;await C({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:s})}}function I({url:e,serverVersion:t,serviceVersion:s,requestInit:r,pingPeriod:i}){return E.create({url:e,serverVersion:t,serviceVersion:s,requestInit:r,pingPeriod:i})}class R extends Error{error;constructor(e){super(e.errorChain[0].message),this.error=e}}class D extends R{}function _(e,t){return e.errorChain.some((e=>e.type===t))}function N(e,t,{signal:s}={}){const{drillthroughColumns:r,isLoading:i}=e.drillthroughColumns[t]??{};return!i&&r?Promise.resolve(r.filter((e=>e.visible))):new Promise(((r,i)=>{const n=e.subscribeToDrillthroughColumns(t,(()=>{const{drillthroughColumns:s,error:a,isLoading:o}=e.drillthroughColumns[t];o||(n(),a?i(a):r(s?.filter((e=>e.visible))))}));e.loadDrillthroughColumns(t,{signal:s}),s&&(s.onabort=()=>{n(),i(s.reason)})}))}function U(e,t){return!e.slicing&&1===t.namePath.length}var P=s(66138);const V={slicer:-1,columns:0,rows:1,pages:2,chapters:3,sections:4};function Q(e){return V[e.toLowerCase()]}const $=e=>{const{range:t}=e;return t&&!t.entireAxis?t.axisLength:e.positions.length};function W(e,t){const s=[],r={};let i,n=0;for(const r of e.axes){const e=[],a=Object.values(r.hierarchies);for(let s=0;s<a.length;s++){const{dimension:o,hierarchy:c}=a[s];if("Measures"===o)i=r,n=s;else{const i=(0,P.q)({dimensionName:o,hierarchyName:c},t),n=Object.values(i.levels).slice(i.slicing?0:1,r.maxLevelPerHierarchy[s]).map((({name:e,index:t})=>({dimensionName:o,hierarchyName:c,levelName:e,hierarchyIndex:s,levelIndex:t})));e.push(...n)}}for(const{hierarchyIndex:t,levelIndex:i,...n}of e){const e=r.positions.every((e=>{if(i<e[t].namePath.length){const s=e[t].namePath[i];return!isNaN(s)}return!0}));s.push({...n,isNumeric:e})}}const a=e.axes.find((({id:e})=>e===V.columns));if(i&&a&&[V.rows,V.columns].includes(i.id)){const t=$(a);for(const s of e.cells){const e=Math.floor(s.ordinal/t),a=s.ordinal%t,o=(i.id===V.columns?a:e)-(i.range?.from??0),c=i.positions[o][n].namePath[0],u=!1!==r[c]?.isNumeric&&!isNaN(s.value);r[c]={isNumeric:u}}}return{levels:s,measures:Object.entries(r).map((([e,{isNumeric:t}])=>({measureName:e,isNumeric:t})))}}const F=(e,t)=>{const s={};return e.axes.forEach(((e,r)=>{-1!==e.id&&(void 0===t||0===e.id&&t.axisNames.includes("COLUMNS")||1===e.id&&t.axisNames.includes("ROWS"))&&e.hierarchies.forEach((({dimension:e,hierarchy:t},i)=>{s[(0,h.hD)(e,t)]={dimensionName:e,hierarchyName:t,axisIndex:r,hierarchyIndex:i}}))})),s},A=({columnIndex:e,data:t,hierarchyIndicesInCellSet:s,rowIndex:r})=>{const i=[];let n=!1;return Object.values(s).forEach((({dimensionName:s,hierarchyName:a,axisIndex:o,hierarchyIndex:c})=>{const u=t.axes[o],l=u.range?.from||0,d=(0===u.id?e:r)-l;u.positions[d]&&(n=!0,void 0!==u.positions[d][c]&&i.push({dimensionName:s,hierarchyName:a,...u.positions[d][c]}))})),n?i:null},O=(e,t,s)=>{const[r,i]=[V.columns,V.rows].map((t=>{const s=e.axes.find((({id:e})=>e===t));return s?.positions.length??1}));let n=0;for(let a=0;a<i;a++)for(let i=0;i<r;i++){let o=null;const c=e.cells[n],u=a*r+i;c?.ordinal===u&&(n+=1,o=c),s({cell:o,cellIndex:o?n-1:null,columnIndex:i,tuple:A({columnIndex:i,data:e,hierarchyIndicesInCellSet:t,rowIndex:a}),rowIndex:a})}},H=e=>(0,g.zipWith)(...e.positions,((...e)=>(0,g.uniqBy)(e,(e=>(0,h.hD)(...e.namePath))))).map(((t,s)=>({axisId:e.id,hierarchy:e.hierarchies[s],members:t}))),j=e=>e.map((({dimensionName:e,hierarchyName:t,namePath:s})=>e===t&&"Measures"===e?(0,h.hD)("Measures",s[0]):(0,h.hD)(e,t,...s))),B=e=>j(e).join(",")||"Total",K=e=>j(e.map((({dimensionName:e,hierarchyName:t,member:s})=>({dimensionName:e,hierarchyName:t,...s})))).sort().join(",")||"Total";function G(e,{cube:t,captionForTotals:s,separator:r=" ",hasOnlyCaptionForLeafLevels:i=!1}){if(0===e.length)return s;let n=!1;const a=(0,g.flatten)(e.map((({dimensionName:e,hierarchyName:s,...r})=>{if(void 0===r)return"";const a=r.namePath??r.path,o=r.captionPath;if("Measures"===e)return o;const c=(0,P.q)({dimensionName:e,hierarchyName:s},t);return c.slicing||1!==a.length?i?o.at(-1):c.slicing?o:o.slice(1):(n=!0,[])})));return(n?[...a,s]:a).join(r)}function z(e,t,s){const r=(0,g.findLastIndex)(e,(e=>"Measures"===e.dimensionName?!s?.doesConsiderMeasuresAsTotals:!U((0,P.q)(e,t),e)));return e.slice(0,r+1)}function J(e,{rowIndexOnScreen:t,rowIndexInData:s,numberOfMissingTotalRowsAbove:r}){if(e)for(let i=0;i<=r;i++)e[t+i]=s}const Y=(e,t,{hierarchies:s,maxLevelPerHierarchy:r,cube:i})=>{const n=[];let[a,o]=((e,t,s)=>{if(!e)return[0,0];for(let r=0;r<s.length;r++)for(let i=0;i<s[r];i++){const s=e[r];if(t[r].namePath[i]!==s.namePath[i])return[r,i]}return[s.length-1,s.at(-1)??0]})(e,t,r);const c=((e,t)=>z(e,t).length)(t,i);for(;a<c;){const e=t[a];for(;o<e.namePath.length&&(a!==c-1||o!==e.namePath.length-1);){const s=[...t.slice(0,a),{...e,namePath:e.namePath.slice(0,o+1),captionPath:e.captionPath.slice(0,o+1)}],r="Measures"===e.dimensionName?null:(0,P.q)(e,i);r&&s.every((e=>U(r,e)))||n.push(s),o++}if(a++,a<s.length){const e=s[a];o=null===e||e.slicing?0:1}}return n};function Z(e,{cube:t,rowIndexMapping:s}){return t?(0,p.produce)(e,(r=>{const i=r.axes.find((({id:e})=>e===V.rows));if(!i)return;const n=i.range?.from??0,a=function(e,t){if(!t||0===e)return 0;let s=t.length-1,r=t[s];const i=e;for(;s>=0&&(r=t[s])&&r>i;)s-=r-i;return s+(e-r)}(n,s);let o=a-n;i.range&&a>0&&(i.range.from+=o,s&&s.length<i.range.from-1&&function(e,t){const s=e.length-1,r=s-e[s];let i=e.length-r;for(;e.length<t+r;)e.push(i),i++}(s,i.range.from));const c=i.hierarchies.map((({dimension:e,hierarchy:s})=>"Measures"===e?null:(0,P.q)({dimensionName:e,hierarchyName:s},t))),u=[];let l=0,d=0;for(;l<i.positions.length;){const[e,r]=[l-1,l].map((e=>{if(-1!==e)return i.positions[e].map(((e,t)=>{const{dimension:s,hierarchy:r}=i.hierarchies[t];return{dimensionName:s,hierarchyName:r,...e}}))})),o=i.range&&i.range.from>0&&0===l?[]:Y(e,r,{cube:t,hierarchies:c,maxLevelPerHierarchy:i.maxLevelPerHierarchy});if(i.positions.splice(l,0,...o),J(s,{rowIndexInData:n+d,rowIndexOnScreen:a+l,numberOfMissingTotalRowsAbove:o.length}),o.length>0){const e=i.range?i.range.from:0;u.push(...(0,g.range)(e+l,e+l+o.length))}l+=o.length+1,d+=1}!function(e,t){if(!e||t>=e.length-1)return;let s=t;for(;e[s+1]>e[s]+1;)e.splice(s+1,0,e[s]+1),s++}(s,a+l-1);const h=e.axes.find((({id:e})=>e===V.columns)),b=h?h.positions.length:0;r.cells.forEach((e=>{const t=Math.floor(e.ordinal/b);for(;u.length>0&&t+o>=u[0];)o+=1,u.shift();e.ordinal+=o*b})),i.range&&(i.range.to+=o,i.range.axisLength+=o)})):e}var X=s(26321),ee=s(4327),te=s(83820),se=s(18774),re=s(26076),ie=s(77840),ne=s(74475),ae=s(70793);function oe(e,{cube:t,levelCoordinates:s}){return(0,te.T)(e,(e=>{if(!(0,ae.k)(e,"Members")||!(0,ne.E)(e.arguments[0]))return!1;const r=(0,ie.t)(e.arguments[0],{cube:t});return"level"===r.type&&(0,X.M)(r,s)}))?.path}function ce(e,{cube:t,hiddenGrandTotalsContextValue:s,hiddenSubTotalsContextValue:r}){const i={},n=s?s.split(","):[],a=(r?r.split(","):[]).map((e=>{const[t,s,r]=(0,d._)(e);return{dimensionName:t,hierarchyName:s,levelName:r}}));return e?.axes.forEach((e=>{const s=function(e,t){const s=(0,se.l)(e,t),r=[],i=[],n=[];if(0===s.length&&-1!==(0,re.n)(e))return{levelsWithToggleableTotals:r,levelsWithHiddenTotals:i,deepLevelsExpressedWithMembers:n,isGrandTotalHidden:!1,isGrandTotalToggleable:!1};let a=!0,o=!1,c=!1;for(let e=s.length-1;e>=0;e--){const{path:u,match:l,...d}=s[e];e===s.length-1||r.unshift(d),c&&i.unshift(d);const h=(0,P.q)(d,t),b=(0,ee.Z)({...d,cube:t});if(b>0){const e=oe(l,{cube:t,levelCoordinates:d});if(void 0!==e){o=!0;const t=[...u,...e];n.unshift({...d,pathWithinAxis:t}),c=!0}}const m=Object.values(h.levels).slice(h.slicing?0:1,b).reverse();for(const e of m){const t={...d,levelName:e.name};r.unshift(t),c&&i.unshift(t)}if(h.slicing){a=!1,o=!0;break}}return{levelsWithToggleableTotals:(0,g.uniqWith)(r,X.M),levelsWithHiddenTotals:(0,g.uniqWith)(i,X.M),deepLevelsExpressedWithMembers:n,isGrandTotalToggleable:a,isGrandTotalHidden:o}}(e,t),r=s.isGrandTotalHidden||n.includes(String(Q(e.name))),o=(0,g.intersectionWith)(s.levelsWithToggleableTotals,[...s.levelsWithHiddenTotals,...a],X.M);i[e.name]={...s,isGrandTotalHidden:r,levelsWithHiddenTotals:o}})),i}},80391:(e,t,s)=>{s.d(t,{d:()=>r});class r{url;serverVersion;serviceVersion;requestInit;constructor({url:e,serverVersion:t,serviceVersion:s,requestInit:r}){this.url=e,this.serviceVersion=s,this.serverVersion=t,this.requestInit=r}}},13434:(e,t,s)=>{s.d(t,{v:()=>r});class r extends Error{static status=400;response;constructor(e){const{url:t}=e;super(`400: Bad request error on: ${t||"unspecified URL"}.`),this.name="BadRequestError",this.response=e}}},27630:(e,t,s)=>{s.d(t,{H:()=>r});class r extends Error{static status=403;expirationDate;constructor(e){super(`Your license expired on ${e.toLocaleDateString()}. Please contact ActiveViam.`),this.name="ExpiredLicenseError",this.expirationDate=e}}},62279:(e,t,s)=>{s.d(t,{q:()=>r});class r extends Error{static status=403;response;constructor(e){const{url:t}=e;super(`403: Access to: ${t||"unspecified URL"} is forbidden.`),this.name="ForbiddenError",this.response=e}}},29204:(e,t,s)=>{s.d(t,{P:()=>r});class r extends Error{static status=500;response;constructor(e){const{url:t}=e;super(`500: Internal server error on: ${t||"unspecified URL"}.`),this.name="InternalServerError",this.response=e}}},3486:(e,t,s)=>{s.d(t,{h:()=>r});class r extends Error{url;constructor(e,t){super(`No response received from: ${e||"unspecified URL"}.`,t),this.name="NoResponseError",this.url=e}}},27803:(e,t,s)=>{s.d(t,{C:()=>r});class r extends Error{static status=404;response;constructor(e){const{url:t}=e;super(`404: The resource at ${t||"unspecified URL"} was not found.`),this.name="ResourceNotFoundError",this.response=e}}},38300:(e,t,s)=>{s.d(t,{D:()=>r});class r extends Error{static status=401;response;constructor(e){const{url:t}=e;super(`401: Not authorized to access: ${t||"unspecified URL"}.`),this.name="UnauthorizedError",this.response=e}}},62355:(e,t,s)=>{s.d(t,{K:()=>d});var r=s(25906),i=s(13434),n=s(27630),a=s(62279),o=s(29204),c=s(3486),u=s(27803),l=s(38300);async function d(e,t){try{const s=await fetch(e,t);switch(s.status){case 400:throw new i.v(s);case 401:throw new l.D(s);case 403:{let e;try{const t=await s.json(),r=(t.error?.errorChain??t.errorChain)[0];"ForbiddenAccessException"===r.type&&r.message.includes("license has expired")&&(e=new Date(r.message.slice(r.message.lastIndexOf("(")+1,r.message.lastIndexOf(")"))))}catch(e){}if(e)throw new n.H(e);throw new a.q(s)}case 404:throw new u.C(s);case 500:throw new o.P(s)}return s}catch(t){const s=(0,r.$)(t);throw"Failed to fetch"===s.message||"NetworkError when attempting to fetch resource."===s.message||"Load failed"===s.message?new c.h(e,{cause:s}):s}}},58720:(e,t,s)=>{s.d(t,{h:()=>i});var r=s(62355);async function i(e,t,s){const{restPath:i}=t;await(0,r.K)(`${e}${i}/ping`,s)}},28733:(e,t,s)=>{s.d(t,{L:()=>r});const r=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},60402:(e,t,s)=>{s.d(t,{S:()=>r});const r=s(28733).L.map((e=>e.toLowerCase()))},77105:(e,t,s)=>{s.d(t,{v:()=>i});var r=s(31529);const i=e=>{const t=e.catalogs.map((e=>{const t=e.cubes.map((e=>(e=>{const t=e.dimensions.map((e=>{const t=e.hierarchies.map((e=>{const t=(0,r.keyBy)(e.levels.map(((e,t)=>({...e,index:t}))),"name");return{...e,levels:t}})),s=(0,r.keyBy)(t,"name");return{...e,hierarchies:s}})),{measures:s,kpis:i,sets:n,contextValues:a,measureGroups:o}=e;return{...e,dimensions:(0,r.keyBy)(t,"name"),measures:(0,r.keyBy)(s,"name"),kpis:(0,r.keyBy)(i,"name"),sets:(0,r.keyBy)(n,"name"),contextValues:(0,r.keyBy)(a,"name"),measureGroups:(0,r.keyBy)(o,"name")}})(e)));return{...e,cubes:(0,r.keyBy)(t,"name")}})),{contextValues:s}=e;return{catalogs:(0,r.keyBy)(t,"name"),contextValues:(0,r.keyBy)(s,"name")}}},22139:(e,t,s)=>{function r(e){return"measure"===e.type?e.measureName:e.identifiers[1].value}s.d(t,{_:()=>r})},26076:(e,t,s)=>{s.d(t,{n:()=>i});var r=s(68079);function i(e){const t=(0,r.s)(e);if(0===t.length)return-1;if(t[0].length<2)return 0;const s=t[0].slice(t[0].length-2);return"arguments"===s[0]?s[1]:0}},68079:(e,t,s)=>{s.d(t,{s:()=>c});var r=s(25503),i=s(95347),n=s(8636),a=s(82889),o=s(36392);const c=e=>{const t=[];if((0,o.n)(e))for(let t=0;t<e.axes.length;t++){const s=c(e.axes[t]);if(s.length>0)return s.map((e=>["axes",t,...e]))}if((0,a.C)(e)){const s=e;(0,r.y)(s,((e,r)=>{if((0,n.D)(s,e,r)&&!t.some((e=>e.every(((e,t)=>r[t]===e))))){const{path:e}=(0,i.A)(s,r);t.push(e)}}))}return t}},8636:(e,t,s)=>{s.d(t,{D:()=>o});var r=s(31529),i=s(15646),n=s(70793),a=s(82889);const o=(e,t,s)=>{if(!(0,i.r)(t))return!1;const o=(0,r.initial)(s),c=(0,r.initial)(o),u=o.length>0?(0,r.get)(e,o):e,l=c.length>0?(0,r.get)(e,c):void 0;return(0,a.C)(u)||(0,n.k)(l)&&("{}"===l.name||"crossjoin"===l.name.toLowerCase())}},15646:(e,t,s)=>{s.d(t,{r:()=>n});var r=s(22139),i=s(74475);const n=(e,{measureName:t}={})=>!(!(0,i.E)(e)||"measures"!==e.identifiers[0].value.toLowerCase()||void 0===e.identifiers[1]||void 0!==t&&(0,r._)(e)!==t)}}]);